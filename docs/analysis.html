---

title: Analyses


keywords: fastai
sidebar: home_sidebar

summary: "Ongoing analyses"
description: "Ongoing analyses"
nb_path: "nbs/90_analysis.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/90_analysis.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><code>light_curves</code> library functions used here</strong></p>
<ul>
<li><a href="/light_curves/cells.html#get_cells"><code>get_cells</code></a></li>
<li><a href="/light_curves/simulation.html#simulate_cells"><code>simulate_cells</code></a></li>
<li><a href="/light_curves/lightcurve.html#get_lightcurve"><code>get_lightcurve</code></a></li>
<li><a href="/light_curves/bayesian.html#get_bb_partition"><code>get_bb_partition</code></a></li>
<li><a href="/light_curves/cells.html#partition_cells"><code>partition_cells</code></a></li>
<li><a href="/light_curves/lightcurve.html#fit_cells"><code>fit_cells</code></a></li>
<li><a href="/light_curves/lightcurve.html#flux_plot"><code>flux_plot</code></a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h2><p>This notebook does not produce a module to add to the library, it a place to run, and report on analyses using the library. It uses local code, shown below.</p>
<p>This is also an exploration of this style of presenting code, and data analysis based on it.</p>
<h2 id="Geminga-analyses">Geminga analyses<a class="anchor-link" href="#Geminga-analyses"> </a></h2><p>Following Kerr's example, we use the source Geminga to check that this analysis of data gives results consistent with its being constant. As you can see below, the BB analysis finds 16 breaks, which merit further checks. That is followed by a simulation using
Geminga's weight distribution and exposure. The run shown here finds one minor break, a change of 0.1%.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Local code</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">light_curves.bayesian</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">light_curves.simulation</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">light_curves.lightcurve</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">light_curves.cells</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">bb_overplot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">bb_fit</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ax</span> <span class="k">else</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
    <span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">((</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span> <span class="s1">&#39;sandybrown&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)),</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">bb_fit</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">simulation</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">bb_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create and analyze a a simulation for the source</span>
<span class="sd">    Returns the simulated, and fit light curves</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lc</span> <span class="o">=</span> <span class="n">get_lightcurve</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">data_cells</span> <span class="o">=</span> <span class="n">get_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>

    <span class="c1">#  Get the rate from the data</span>
    <span class="n">cq</span> <span class="o">=</span> <span class="n">data_cells</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;e&gt;0.3&#39;</span><span class="p">)</span>
    <span class="n">T</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cq</span><span class="o">.</span><span class="n">tw</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cq</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="n">sflux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">N</span><span class="o">/</span><span class="n">T</span>

    <span class="c1"># simulate, then fit cells to create a simulated light curve </span>
    <span class="n">sim_cells</span> <span class="o">=</span> <span class="n">simulate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="n">sflux</span>  <span class="p">)</span>
    <span class="n">sim_lc</span>  <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">sim_cells</span><span class="p">)</span> 

    <span class="n">sim_edges</span> <span class="o">=</span> <span class="n">get_bb_partition</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">sim_lc</span><span class="p">,</span>  <span class="n">key</span><span class="o">=</span><span class="n">bb_key</span><span class="p">)</span> <span class="c1">#&#39;simulated_BB_partition_Geminga&#39;) </span>

    <span class="c1"># partion, then fit the cells according to the edges</span>
    <span class="n">sim_bb_cells</span> <span class="o">=</span> <span class="n">partition_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">sim_cells</span><span class="p">,</span> <span class="n">sim_edges</span><span class="p">);</span>
    <span class="n">sim_bb_fit</span>  <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">sim_bb_cells</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">sim_lc</span><span class="p">,</span> <span class="n">sim_bb_fit</span>

<span class="k">def</span> <span class="nf">analyze_data</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze data from the source</span>
<span class="sd">    </span>
<span class="sd">    Returns, data a partitioned light curves</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lc</span> <span class="o">=</span> <span class="n">get_lightcurve</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="n">get_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">get_bb_partition</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">LikelihoodFitness</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;bb-Geminga-test&#39;</span><span class="p">)</span> 
    <span class="n">bb_cells</span> <span class="o">=</span> <span class="n">partition_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">,</span> <span class="n">edges</span><span class="p">);</span>
    <span class="n">bb_lc</span>  <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">bb_cells</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">lc</span><span class="p">,</span> <span class="n">bb_lc</span>

<span class="k">def</span> <span class="nf">fit_table</span><span class="p">(</span><span class="n">lc</span><span class="p">,</span> <span class="n">expect</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a summary table from a light curve&quot;&quot;&quot;</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">fit</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">f</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">f</span><span class="o">.</span><span class="n">flux</span> <span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">sigma_dev</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">sigma_dev</span><span class="p">(</span><span class="n">expect</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">lc</span><span class="p">[</span><span class="s1">&#39;t tw n&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># maybe fix warnings?</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flux</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">values</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;sigma_dev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma_dev</span><span class="o">.</span><span class="n">values</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Current-Cache-contents">Current Cache contents<a class="anchor-link" href="#Current-Cache-contents"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">Config</span><span class="p">()</span><span class="o">.</span><span class="n">cache</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Cache contents
 key                          size  time                 name, in folder /tmp/lc_cache
  gti                      1018319  2020-12-25 07:33     cache_file_535b334765658717.pkl
  photons_Geminga         22334705  2020-12-25 07:33     cache_file_2cc2392e195286f.pkl
  exposure_Geminga        86263776  2020-12-25 07:35     cache_file_61db20b268464ed0.pkl
  binned_exposure_Geminga       64448  2020-12-25 07:35     cache_file_2cb93a4162c9697.pkl
  cells_Geminga            1500794  2020-12-25 07:35     cache_file_b77bdecc77e950d.pkl
  lightfcurve_Geminga     11190422  2020-12-25 07:35     cache_file_caaac8884562df3.pkl
  bb-Geminga-test              289  2020-12-25 07:39     cache_file_fa31b9e1163f828.pkl
  weight_hist_Geminga          556  2020-12-25 07:39     cache_file_159a990a784a38b.pkl
  analysis_plot_sim            177  2020-12-25 07:43     cache_file_6dc00e37b52d97c.pkl
  photons_3C 279           3659049  2020-12-25 09:59     cache_file_1db8a8042fd1cdbd.pkl
  exposure_3C 279         78045888  2020-12-25 10:02     cache_file_56763e7e35d1bc39.pkl
  binned_exposure_3C 279       64448  2020-12-25 10:02     cache_file_2fb5d90f2b7c266.pkl
  cells_3C 279              557825  2020-12-25 10:02     cache_file_48640e66d18a391.pkl
  lightfcurve_3C 279       4387626  2020-12-25 10:02     cache_file_d9744ed5e42451c.pkl

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Check-fit-to-all-simulated-Geminga">Check fit to all simulated Geminga<a class="anchor-link" href="#Check-fit-to-all-simulated-Geminga"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.loglike</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
<span class="n">cells</span> <span class="o">=</span> <span class="n">get_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">concatenate_cells</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Cell data for Geminga: Restoring from cache with key &#34;cells_Geminga&#34;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">ll</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fit: &#39;</span><span class="p">,</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">())</span>
<span class="n">ll</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlim</span> <span class="o">=</span><span class="p">(</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">1.005</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>light_curves.loglike.LogLike:  time 56690.500, 1080435 weights, S 716237.6, B 364197.6 
Fit:  {&#39;counts&#39;: 1080435, &#39;flux&#39;: 0.9963, &#39;sig_flux&#39;: 0.0013}
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">analysis_plots</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">expect</span><span class="o">=</span><span class="mf">0.9963</span><span class="p">,</span> <span class="n">short</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">simname</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    #### {sim} Geminga data</span>
<span class="sd">    </span>
<span class="sd">    Get, or simulate, the daily binned data, or cells; perform Bayesian Blocks partition;</span>
<span class="sd">    make fits to the blocks. &lt;br&gt;(Run at {date})</span>
<span class="sd">    </span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    This shows the fits to all cells, with the BB fit overlays</span>
<span class="sd">    {fig1}</span>
<span class="sd">    </span>
<span class="sd">    Since this is a constant source, there should be no breaks, that is, only one partition.</span>
<span class="sd">    Here is a table of the partition fits:</span>
<span class="sd">    </span>
<span class="sd">    {df_text}</span>
<span class="sd">    The last column represents the compatibility of the flux measurement for each partition</span>
<span class="sd">    with the expected value {expect} in equivalent sigma units.</span>
<span class="sd">    </span>
<span class="sd">    Expand the plot around short, &lt; {short} day partitions.</span>
<span class="sd">    {short_check}</span>
<span class="sd">    </span>
<span class="sd">    {fig2}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">simulated</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">simname</span><span class="p">)</span>
    <span class="n">sim</span><span class="o">=</span> <span class="s1">&#39;Simulated&#39;</span> <span class="k">if</span> <span class="n">simulated</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Analysis output&#39;</span> <span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">simulated</span><span class="p">:</span>
            <span class="n">lc</span><span class="p">,</span> <span class="n">bb_lc</span> <span class="o">=</span> <span class="n">analyze_data</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">lc</span><span class="p">,</span> <span class="n">bb_lc</span> <span class="o">=</span> <span class="n">simulation</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">bb_key</span><span class="o">=</span><span class="n">simname</span><span class="p">)</span> 

    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="c1">#, &#39;display.colheader_justify&#39;,&#39;left&#39;)</span>
    <span class="n">expect</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">fit_table</span><span class="p">(</span><span class="n">bb_lc</span><span class="p">,</span> <span class="n">expect</span><span class="o">=</span><span class="n">expect</span><span class="p">)</span>
    <span class="n">df_text</span> <span class="o">=</span> <span class="n">monospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="s1">&#39;BB fit table&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bb_overplot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">bb_lc</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>  <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">);</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span>

    <span class="n">bb_short</span> <span class="o">=</span> <span class="n">bb_lc</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;tw&lt;</span><span class="si">{</span><span class="n">short</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span> <span class="n">ns</span> <span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bb_short</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ns</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">short_check</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="n">ns</span><span class="si">}</span><span class="s1"> such.&#39;</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="p">(</span><span class="n">ns</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span>
        <span class="n">fig2</span><span class="p">,</span> <span class="n">axx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span> <span class="n">rows</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span>  <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">cols</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">rows</span><span class="p">),</span>
                                 <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">gridspec_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">),</span><span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ns</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">fig2</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span>
        <span class="n">axf</span> <span class="o">=</span> <span class="n">axx</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axf</span><span class="p">[</span><span class="n">ns</span><span class="p">:]]</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bb_short</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">axf</span><span class="p">):</span>
            <span class="n">bb_overplot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">bb_lc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">tzero</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span> <span class="o">+</span><span class="mi">50</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig2</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
        <span class="n">short_check</span> <span class="o">=</span> <span class="s1">&#39;None found.&#39;</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="TO-DO">TO DO<a class="anchor-link" href="#TO-DO"> </a></h2><ul>
<li><p>Fix a 0.4% bias from the cell fit when applied to high-statisics data.</p>
</li>
<li><p>Look at the 6 intervals detected for the data, of which 5 have measured flux increases around 10%,  more than 4$\sigma$. Possibilities are a problem with the exposure, and a change in the background. The latter can be examined by a 2-D fit with $\beta$ free. Another possibility, fixing $\alpha=0$ and fitting $\beta$ is not (yet) supported.</p>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>date
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Fri Dec 25 11:25:40 PST 2020
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

