---

title: Simulation


keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>WeightGenerator</code> class accepts <code>alpha</code> and <code>beta</code> parmeters, which will be used to weight the weight distribution  by a factor</p>
<p>{% raw %}
$$ \big(1 + \alpha w + \beta (1-w)\ \big) $$
{% endraw %}</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is encapsulated by <a href="/light_curves/simulation.html#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="/light_curves/simulation.html#generate_cells"><code>generate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L18" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- the function, or a histogram</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram)</li>
</ul>
<p>Note the property <code>mean</code> is the expected mean.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="_Sampler-tests:--Gaussian-and-quadratic-functions"><code>_Sampler tests</code>:  Gaussian and quadratic functions<a class="anchor-link" href="#_Sampler-tests:--Gaussian-and-quadratic-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test-_Sampler-with-a-histogram">Test <code>_Sampler</code> with a histogram<a class="anchor-link" href="#Test-_Sampler-with-a-histogram"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weight histogram for Geminga: Restoring from cache with key &#34;weight_hist_Geminga&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArkAAAD4CAYAAADoxf5UAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjMsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+AADFEAAAgAElEQVR4nO3dfXRU1b3/8c9OSIBglARExNQEW0SBAQwTHspjRXkQGgrNXaIokGVLtdfqr71tARfF+tRCxdurtYAsMajYhrtSQS3WYlXKgyImiAaCrVQeDC0FA0jAICbs3x+BXDAJOWcyZzJz5v1aKwuS2XPON7MnyWf27LO3sdYKAAAA8JOEli4AAAAACDdCLgAAAHyHkAsAAADfIeQCAADAdwi5AAAA8J1WXhy0Y8eONisry4tDAwAAAJKkkpKST6y1Fzd0mychNysrS8XFxV4cGgAAAJAkGWP2NHYb0xUAAADgO4RcAAAA+A4hFwAAAL7jyZzchnzxxRcqLy/XiRMnInVKICq0adNGGRkZSkpKaulSAACIGxELueXl5UpNTVVWVpaMMZE6LdCirLWqqKhQeXm5unbt2tLlAAAQNyI2XeHEiRPq0KEDARdxxRijDh068A4GAAARFtE5uQRcxCOe9wAARB4XngEAAMB34jbk/vznP9eCBQvO22bVqlUqKyuLUEWRUV1drXvuuUfdunVT37591bdvXz300ENhOXZxcbHuuuuusBwLAACgOSJ24VksWrVqlcaPH68ePXq0dCl1qqur1apV6N02Z84c7d+/X6WlpWrTpo0qKyv1yCOPhKW2YDCoYDAYlmMBABAvBs97XfuOVDluf1n7tto461oPK/IJa23YP/r162e/rKysrN7XIu3BBx+0V155pR05cqSdPHmyffjhh6211i5ZssQGg0Hbu3dvO2nSJHv8+HG7ceNGm5aWZrOysmyfPn3szp07G2x3Ptu2bbM5OTm2T58+NhAI2L///e/WWmsfeeQR27NnT9uzZ0/761//2lpr7a5du2zPnj3r7vvwww/be++911pr7fDhw+3s2bPtsGHD7IIFC+z+/fvtt771Ldu7d2/bu3dvu3HjRmuttc8++2zd+WbMmGGrq6vPqef48eM2PT3dHj16tNGaGztGu3bt7E9/+lObnZ1tR44cad9++207fPhw27VrV/vCCy9Ya61944037Lhx46y11t577702Pz+/rs2jjz5ad47777/fdu/e3V533XVN9oNfRMPzHwAQnTJn/tHT9n4mqdg2kkdbZiT3T7Ok/aXhPWbngDR2XqM3l5SUqLCwUO+++66qq6uVnZ2tfv36SZImTZqk7373u5JqRzqXLl2qH/zgB8rNzdX48eOVl5cnSWrfvn2D7RqzePFi3X333ZoyZYpOnjypmpoalZSUqKCgQG+//bastRowYICGDx+utLS08357R44c0V//+ldJ0o033qjhw4dr5cqVqqmp0bFjx7Rjxw6tWLFCGzduVFJSkr7//e/rueee09SpU+uOsXPnTl1++eVKTU1t8BznO8bx48c1YsQIzZ8/XxMnTtScOXP06quvqqysTNOmTVNubm69433wwQd64403VFlZqe7du+uOO+7Qe++9pz/84Q+u+gEAAISouEAqLXJ/v0CeFMwPfz0RFDfTFdavX6+JEycqJSVFks4JZdu2bdOcOXN05MgRHTt2TKNHj27wGE7bnTFo0CA99NBDKi8v16RJk9StWzdt2LBBEydOVLt27STVBrv169c3GBLPduONN9b9//XXX9czzzwjSUpMTNRFF12kZ599ViUlJcrJyZEkVVVVqVOnTuc9ZkFBgR599FFVVFTozTff1GuvvdboMZKTkzVmzBhJUiAQUOvWrZWUlKRAIKDdu3c3ePxx48apdevWat26tTp16qR///vf2rBhgyZMmKC2bdtKkr75zW/WtXf7+AIAgCaUFtUOLHYOOL/PmYFIQm4IzjPi6qXGlnKaPn26Vq1apT59+mjZsmVau3Zts9qdcfPNN2vAgAFavXq1Ro8erSeffFK1I+v1tWrVSqdOnar7/Mvrqp4JxY2x1mratGn65S9/2Wibr33ta9q7d68qKyuVmpqq/Px85efnq1evXqqpqTnvMZKSkuoev4SEBLVu3bru/9XV1Q2e70wbqTaMV1dXN/r9S+4fXwAA4EDngJS/2nn7gnHe1RJBcbO6wrBhw7Ry5UpVVVWpsrJSL730Ut1tlZWVuvTSS/XFF1/oueeeq/t6amqqKisrm2y3cuVKzZ49u945P/roI11xxRW66667lJubq/fff1/Dhg3TqlWr9Nlnn+n48eNauXKlhg4dqksuuUQHDhxQRUWFPv/8c/3xj39s9HsZOXKkFi1aJEmqqanR0aNHNXLkSBUVFenAgQOSpEOHDmnPnj3n3C8lJUW33Xab7rzzzroQXVNTo5MnT9Ydt6ljNNeQIUP00ksv6cSJEzp27JhWr/6/H7rGHl8AAAC34ma6QnZ2tm688Ub17dtXmZmZGjp0aN1tDzzwgAYMGKDMzEwFAoG6YDt58mR997vf1WOPPaaioqJG2/3jH//QhRdeWO+cK1as0PLly5WUlKTOnTtr7ty5Sk9P1/Tp09W/f39J0ne+8x1dc801kqS5c+dqwIAB6tq1q6666qpGv5dHH31UM2bM0NKlS5WYmKhFixZp0KBBevDBBzVq1CidOnVKSUlJ+u1vf6vMzMxz7vvQQw/pZz/7mXr16qXU1FS1bdtW06ZNU5cuXZScnOzoGM2Rk5Oj3Nxc9enTR5mZmQoGg7roooskNd4PAAD4VnGBCpOfkAoWOr7LTYndJfljtNVL5nxvH4cqGAza4uLic762Y8cOXX311WE/VzS45ZZb9Otf/1oXX3xxS5cSE44dO6YLLrhAn332mYYNG6YlS5YoOzu7pcvylJ+f/wCAZigYp6O7t+jCLId/B/eXalNVFw28f5Pj40sKbbqCm/u0EGNMibW2wfVL42Yk10vLly9v6RJiyowZM1RWVqYTJ05o2rRpvg+4AACcT5nN1ECngbJgnLSrwtuCfMJRyDXG7JZUKalGUnVjiRlw4ne/+11LlwAAAHzOzUjuN6y1n3hWCQAAABAmcbO6AgAAAOKH05BrJa0xxpQYY2Y01MAYM8MYU2yMKT548GD4KgQAAABcchpyB1trsyWNlfSfxphhX25grV1irQ1aa4OsMgAAAICW5GhOrrX2n6f/PWCMWSmpv6R1zTnx4Hmva9+RquYc4hyXtW+rjbOudX2/73znO/rRj36kHj16NLuGrKwsFRcXq2PHjo22+cUvfqF77rmn7vOvf/3revPNN5t97qYsXrxYKSkpmjp1qpYtW6ZRo0apS5cujuuuqKhQXl6e3nnnHU2fPl2PP/543W0lJSWaPn26qqqqdMMNN+jRRx+VMUaff/65pk6dqpKSEnXo0EErVqxQVlaWJOnpp5/Wgw8+KEmaM2eOpk2bJknatWuXJk+erEOHDik7O1vPPvuskpOTPXpUnLngggt07NixFq0BAAC402TINca0k5Rgra08/f9Rku5v7on3HanS7nnhW8g4a1Zoa7k9+eSTYavBiS+H3EgEXEm6/fbb6/6/bNky9erVqy7kOtGmTRs98MAD2rZtm7Zt23bObXfccYeWLFmigQMH6oYbbtArr7yisWPHaunSpUpLS9POnTtVWFiomTNnasWKFTp06JDuu+8+FRcXyxijfv36KTc3V2lpaZo5c6Z++MMfavLkybr99tu1dOlS3XHHHWF7HAAAQHxwMl3hEkkbjDHvSdosabW19hVvywq/48ePa9y4cerTp4969eqlFStWSJJGjBihMxtXXHDBBZo5c6b69eun6667Tps3b9aIESN0xRVX6MUXX5RUGxDvvPPOuuOOHz9ea9eurXe+b33rW+rXr5969uypJUuWSJJmzZqlqqoq9e3bV1OmTKk7pyRZa/WTn/xEvXr1UiAQqKtv7dq1GjFihPLy8nTVVVdpypQp+vIGHgcOHFC/fv0kSe+9956MMdq7d68k6atf/ao+++wz/fznP9eCBQtUVFSk4uJiTZkyRX379lVVVe1o+m9+8xtlZ2crEAjogw8+qPf9tGvXTkOGDFGbNm3O+fq//vUvHT16VIMGDZIxRlOnTtWqVaskSS+88ELdCG1eXp5ee+01WWv15z//Wddff73S09OVlpam66+/Xq+88oqstXr99deVl5cnSZo2bVrdsc62fft29e/fX3379lXv3r314YcfNvqYu+nXCRMmaMyYMerevbvuu+++eueVpIcfflg5OTnq3bu37r33XkmNP7cAAEDLaXIk11r7kaQ+EajFU6+88oq6dOmi1atrR3w//fTTem2OHz+uESNGaP78+Zo4caLmzJmjV199VWVlZZo2bZpyc3Mdn++pp55Senq6qqqqlJOTo29/+9uaN2+eHn/8cW3durVe++eff15bt27Ve++9p08++UQ5OTkaNqx26vO7776r7du3q0uXLho8eLA2btyoIUOG1N23U6dOOnHihI4ePar169crGAxq/fr1GjJkiDp16qSUlJS6tnl5eXr88ce1YMECBYP/t9xxx44dtWXLFi1cuFALFixwPMK9b98+ZWRk1H2ekZGhffv21d32la98RZLUqlUrXXTRRaqoqDjn62ffp6KiQu3bt1erVq3qHetsixcv1t13360pU6bo5MmTqqmpafQx79Chg+N+3bx5s7Zt26aUlBTl5ORo3Lhx5zxGa9as0YcffqjNmzfLWqvc3Fyt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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L58" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test--_WeightGenerator">Test  <code>_WeightGenerator</code><a class="anchor-link" href="#Test--_WeightGenerator"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      
<span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L75" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
light_curves.loglike.LogLike:  10474 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10474.000
flux            1.072
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cells" class="doc_header"><code>generate_cells</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L112" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cells</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>&lt;lambda&gt;</code></em>)</p>
</blockquote>
<ul>
<li><code>source</code> -- a PointSource object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Generate-a-set-of-poisson-like-fits-to-the-likelihoods">Generate a set of poisson-like fits to the likelihoods<a class="anchor-link" href="#Generate-a-set-of-poisson-like-fits-to-the-likelihoods"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ## Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N} cells with the function {wfun}</span>

<span class="sd">    The &quot;pulls&quot;</span>
<span class="sd">    {fig1}</span>
<span class="sd">    </span>
<span class="sd">    A better measure of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="k">def</span> <span class="nf">generate_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">return</span>  <span class="p">[</span><span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span> <span class="p">,</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">cells</span> <span class="o">=</span>  <span class="n">generate_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="n">pfits</span>  <span class="o">=</span> <span class="p">[</span><span class="n">PoissonRep</span><span class="p">(</span><span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span> <span class="p">))</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">]</span>

    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Flux: mean, std: </span><span class="si">{</span><span class="n">flux</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">flux</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; pull: mean, std: </span><span class="si">{</span><span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Flux: mean, std: 2.998, 0.259
 pull: mean, std: -0.050, 1.003
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h2><p>Generate 10000 cells with the function &lt;function simulation_test.<locals>.<lambda> at 0x7f5e0c9475f0&gt;</p>
<p>The "pulls"</p>
<div class="nbdoc_image">
<a href="images/simulation_test_fig_01.png"><figure style="margin-left: 5%">
   <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300> 
</figure></a></div><p>A better measure of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<a href="images/simulation_test_fig_03.png"><figure style="margin-left: 5%">
   <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300> 
</figure></a></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="s1">&#39;Geminga&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">generate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source Geminga, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>binned exposure for source Geminga: Restoring from cache with key "binned_exposure_Geminga"<br>Weight histogram for Geminga: Restoring from cache with key "weight_hist_Geminga"<br>Loaded 3873 / 4015 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<a href="images/simulation_lightcurve_demo_fig_01.png"><figure style="margin-left: 5%">
   <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500> 
</figure></a></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

