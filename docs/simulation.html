---

title: Simulation


keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code> and <code>beta</code> parmeters, which will be used to weight the weight distribution  by a factor</p>
<p>{% raw %}
$$ \big(1 + \alpha w + \beta \ (1-w)\ \big) $$
{% endraw %}</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="/light_curves/simulation.html#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="/light_curves/simulation.html#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Use-a--histogram">Use a  histogram<a class="anchor-link" href="#Use-a--histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weight histogram for Geminga: Saving to cache with key &#34;weight_hist_Geminga&#34;
Photon data: Saving to cache with key &#34;photons_Geminga&#34;
Processing 11 FITS files with GTI information ...  11 files, 63635 intervals with 3,322 days live time
Loading  132 months from Arrow dataset /home/burnett/data/dataset
....................................................................................................................................
	Selected 1,313,726 photons within 5 deg of  (195.13,4.27)
	Energies: 100.0-1000000 MeV
	Dates:    2008-08-04 15:46 - 2019-08-03 01:17
	MJD  :    54682.7          - 58698.1         
Load weights from file /mnt/c/users/thbur/OneDrive/fermi/weight_files/Geminga_weights.pkl
	Found: PSR J0633+1746 at (195.14, 4.27)
	Applyng weights: 240 / 1313726 photon pixels are outside weight region
	233109 weights set to NaN
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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C9pzS2DVrl2bu+++m0cffZRf/OIXF5U/9thjREVF8eOPP7Jx40b69OlDx44d6dChAwUFBfTt25fXXnuN22+/nd///vf079+fNWscy8DNmTOHjz76iE2bNmGMoVevXrRs2ZKHH34YcGwk0bVrVxYvXszixYvJzMxk586dVMfNO0QktOj2shszZ84kKSmJuLg42rZty9KlSwGYNGmScyef7OxsjDHMnTuX5s2bk5CQwJ/+9CfWrVvHVVddRXx8fLklBi+89sLrz549e9Hr7969mxtvvJGGDRuSmJjIr371K44ePQrAkCFDyM3N5fbbbyc2NpZnnnnmoufKz8/njjvuoEGDBrRu3ZpXX321XBx3330399xzj3NTeFfrY4NjM/hf//rXgGMP3bp16/LEE08AUFRURHR0NEeOHCn3+uPHj2fVqlWMGDGC2NjYcnXw+eefc8UVV5CQkMBjjz3mdtu8tm3bMmzYMDp06HBR2cmTJ3n//fd5+umniY2NpXv37txxxx28+eabAHzwwQd06NCBfv36ER0dzaRJk9i0aRPff/89AG+88QajR48mOTmZpKQkRo8ezbx58wDYsWMHGzZs4KmnniImJoa77rqL9PR03n//fZdxfvXVV2RkZFCvXj2aNGnC448/7izr168fTZs2pX79+lx//fVs3brVWXbffffx6KOPcttttxEbG8t1113H/v37GTVqFAkJCVx55ZV88803zvPT0tKYPn067du3JyEhgaFDh1JcXOwypvz8fO666y4aNWpEixYteOmll3yKV0SCT0nXhe3btzN79mzWrVvH8ePHWbJkCWlpaW7PX7t2LTt37uTdd99l1KhRTJ06lc8//5ytW7eyYMGCSi2mb1kWY8eOJT8/n23btrFv3z7n9nxvvvkmKSkpfPLJJ5w4ccKZBC80cOBAkpOTyc/PZ+HChYwbN875wQHg448/ZsCAARw9epQ77rjD7frDPXr0YPny5QCsW7eOpk2bOt/Pl19+Sdu2bUlISCh3zdSpU/nZz37G7NmzOXHiRLnt8z799FPWrVvHpk2bWLBgQaW289uxYweRkZG0adPGeez8VoYAW7dupWPHjs6yunXr0qpVK7flFa9t2bIlcXFxLssrGjlyJCNHjqSwsJDdu3dz9913O8tuu+02du7cyYEDB+jUqRO/+tWvyl27YMECpkyZQkFBAXXq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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L74" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test">Test<a class="anchor-link" href="#Test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      
<span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
light_curves.loglike.LogLike:  10565 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10565.000
flux            1.104
sig_flux        0.017
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>simulate_cells</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>&lt;lambda&gt;</code></em>)</p>
</blockquote>
<ul>
<li><code>source</code> -- a PointSource object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=50, alpha=0 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.079, 1.041: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Follow-on:-combine-the-cells-and-fit-the-result">Follow-on: combine the cells and fit the result<a class="anchor-link" href="#Follow-on:-combine-the-cells-and-fit-the-result"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cells</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="s1">&#39;Geminga&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cells</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source Geminga, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>binned exposure for source Geminga: Saving to cache with key "binned_exposure_Geminga"<br>exposure for Geminga: Saving to cache with key "exposure_Geminga"<br>Processing 12 S/C history (FT2) files<br>  applying cuts cos(theta) &lt; 0.4,  z &lt; 100<br>   file /home/burnett/work/lat-data/ft2/ft2_2008.fits: 362996 entries, 360944 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2009.fits: 874661 entries, 870446 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2010.fits: 889547 entries, 884697 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2011.fits: 882832 entries, 871672 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2012.fits: 881317 entries, 868109 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2013.fits: 885307 entries, 867342 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2014.fits: 894730 entries, 886570 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2015.fits: 890006 entries, 886086 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2016.fits: 890933 entries, 884823 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2017.fits: 888349 entries, 883761 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2018.fits: 842824 entries, 830723 in GTI<br>   file /home/burnett/work/lat-data/ft2/ft2_2019.fits: 737029 entries, 514657 in GTI<br>   Found 9,609,830 S/C entries:  2,695,715 remain after zenith and theta cuts<br>Calculate exposure using the energy domain 100.0-1000000.0 4 bins/decade<br>2695715 entries, MJD 54683 - 58698<br>Time bins: 4015 intervals of 1 days, in range (54683.0, 58698.0)<br>Weight histogram for Geminga: Restoring from cache with key "weight_hist_Geminga"<br>Loaded 3873 / 4015 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_lightcurve_demo_fig_01.png" title="images/simulation_lightcurve_demo_fig_01.png">    <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

