---

title: Simulation


keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>WeightGenerator</code> class accepts <code>alpha</code> and <code>beta</code> parmeters, which will be used to weight the weight distribution  by a factor</p>
<p>{% raw %}
$$ \big(1 + \alpha w + \beta (1-w)\ \big) $$
{% endraw %}</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is encapsulated by <a href="/light_curves/simulation.html#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="/light_curves/simulation.html#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L18" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- the function, or a histogram</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram)</li>
</ul>
<p>Note the property <code>mean</code> is the expected mean.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="_Sampler-tests:--Gaussian-and-quadratic-functions"><code>_Sampler tests</code>:  Gaussian and quadratic functions<a class="anchor-link" href="#_Sampler-tests:--Gaussian-and-quadratic-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test-_Sampler-with-a-histogram">Test <code>_Sampler</code> with a histogram<a class="anchor-link" href="#Test-_Sampler-with-a-histogram"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weight histogram for Geminga: Restoring from cache with key &#34;weight_hist_Geminga&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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k/RYSy988Hil9i8M3TIYaQ5fHBd74YUXQlaDExeH3HAEXEm677776j5euXKl+vXrVxdynWjXrp0ef/xx7d69W7t3777gsfvvv1/Lly9XZmambr/9dr355puaMGGCVqxYoeTkZJWUlGj16tWaM2eO1qxZo6NHj+rRRx9VQUGBjDEaPHiwsrKylJycrDlz5uif/umfNHXqVN13331asWKF7r///pA9DwAARJoz1TXOM1HuEuXvi/4td8PByXSFKyRtNcbskrRd0npr7ZvelhV6p06d0sSJEzVgwAD169dPa9askSSNGTNG5zauuOyyyzRnzhwNHjxYt9xyi7Zv364xY8bommuu0euvvy6pNiA+8MADdee94447tGnTpnrX+973vqfBgwerb9++Wr58uSRp7ty5qqys1MCBAzVt2rS6a0qStVY//vGP1a9fPwUCgbr6Nm3apDFjxig7O1s33HCDpk2bpos38Dh8+LAGDx4sSdq1a5eMMTpw4IAk6Tvf+Y6++uor/exnP9PixYuVl5engoICTZs2TQMHDlRlZe1o+n/8x38oPT1dgUBAH3/8cb3vp0OHDhoxYoTatWt3wdf/9re/6cSJExo2bJiMMZo+fbrWrVsnSXrttdfqRmizs7P19ttvy1qrP/7xj7r11luVkpKi5ORk3XrrrXrzzTdlrdXGjRuVnZ0tSZoxY0bduc63Z88eDRkyRAMHDlT//v316aefNvqcu+nXSZMmafz48erdu7ceffTReteVpKeffloZGRnq37+/HnnkEUmNv7YAAEDraXIk11r7maQBYajFU2+++aZ69Oih9etrR3y//PLLem1OnTqlMWPGaNGiRZo8ebLmz5+vt956S8XFxZoxY4aysrIcX+/FF19USkqKKisrlZGRob//+7/XwoUL9fzzz2vnzp312v/2t7/Vzp07tWvXLn3xxRfKyMjQqFG1U58//PBD7dmzRz169NDw4cO1bds2jRgxou7Ybt266fTp0zpx4oS2bNmiYDCoLVu2aMSIEerWrZvat29f1zY7O1vPP/+8Fi9erGDwf5c77tq1q3bs2KElS5Zo8eLFjke4Dx48qJ49e9Z93rNnTx08eLDusW9/+9uSpDZt2qhTp04qLy+/4OvnH1NeXq7OnTurTZs29c51vmXLlumhhx7StGnTdObMGVVXVzf6nHfp0sVxv27fvl27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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L58" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test--_WeightGenerator">Test  <code>_WeightGenerator</code><a class="anchor-link" href="#Test--_WeightGenerator"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      
<span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L75" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
light_curves.loglike.LogLike:  10516 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10516.000
flux            1.085
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L112" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>simulate_cells</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>&lt;lambda&gt;</code></em>)</p>
</blockquote>
<ul>
<li><code>source</code> -- a PointSource object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Generate-a-set-of-poisson-like-fits-to-the-likelihoods">Generate a set of poisson-like fits to the likelihoods<a class="anchor-link" href="#Generate-a-set-of-poisson-like-fits-to-the-likelihoods"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ## Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N} cells with the function {wfun}</span>

<span class="sd">    The &quot;pulls&quot;</span>
<span class="sd">    {fig1}</span>
<span class="sd">    </span>
<span class="sd">    A better measure of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="k">def</span> <span class="nf">simulate_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">return</span>  <span class="p">[</span><span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span> <span class="p">,</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="n">pfits</span>  <span class="o">=</span> <span class="p">[</span><span class="n">PoissonRep</span><span class="p">(</span><span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span> <span class="p">))</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">]</span>

    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Flux: mean, std: </span><span class="si">{</span><span class="n">flux</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">flux</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; pull: mean, std: </span><span class="si">{</span><span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Flux: mean, std: 3.005, 0.263
 pull: mean, std: -0.023, 1.019
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h2><p>Generate 10000 cells with the function &lt;function simulation_test.<locals>.<lambda> at 0x7f2e95662680&gt;</p>
<p>The "pulls"</p>
<div class="nbdoc_image">
<a href="images/simulation_test_fig_01.png"><figure style="margin-left: 5%">
   <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300> 
</figure></a></div><p>A better measure of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<a href="images/simulation_test_fig_03.png"><figure style="margin-left: 5%">
   <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300> 
</figure></a></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="s1">&#39;Geminga&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source Geminga, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>binned exposure for source Geminga: Restoring from cache with key "binned_exposure_Geminga"<br>Weight histogram for Geminga: Restoring from cache with key "weight_hist_Geminga"<br>Loaded 3873 / 4015 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<a href="images/simulation_lightcurve_demo_fig_01.png"><figure style="margin-left: 5%">
   <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500> 
</figure></a></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

