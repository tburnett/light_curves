---

title: Simulation


keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code> and <code>beta</code> parmeters, which will be used to weight the weight distribution  by a factor</p>
<p>{% raw %}
$$ \big(1 + \alpha w + \beta \ (1-w)\ \big) $$
{% endraw %}</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="/light_curves/simulation.html#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="/light_curves/simulation.html#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Use-a--histogram">Use a  histogram<a class="anchor-link" href="#Use-a--histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weight histogram for Geminga: Restoring from cache with key &#34;weight_hist_Geminga&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAgAAADCCAYAAADEpfDbAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjMsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+AADFEAAAgAElEQVR4nO3df3hV1Zno8e8iJBCEEVARlUKwUiwlgCH8sCqg1QLFgYGhj6hVyNgy2mv1znPrBR1Lba0WZ5yO2tYfVI11sAO3aaG0thatwwAqpYGCUdArFVBQCkapIFAE1v0jkMuvwAlnn+Tk5Pt5njzkZO/z7vecLJLsd797rRBjRJIkSZIkNW8tGjsBSZIkSZLU+CwQSJIkSZIkCwSSJEmSJMkCgSRJkiRJwgKBJEmSJEnCAoEkSZIkSQJaZiLoqaeeGouKijIRWpIkSZIknaBly5a9F2M87WjbMlIgKCoqorKyMhOhJUmSJEnSCQohrK9rm7cYSJIkSZIkCwSSJEmSJMkCgSRJkiRJIkNzEBzNxx9/zIYNG9i1a1dDHVLKCq1bt6ZLly7k5+c3diqSJEmSVKcGKxBs2LCBdu3aUVRURAihoQ4rNaoYI9XV1WzYsIHu3bs3djqSJEmSVKcGKxDs2rXL4oCanRACp5xyClu2bGnsVCRJkqSUXTD9eTZu3ZlIrLPaF/LC1EsSiaXMarACAWBxQM2S416SJElNzcatO1k3fVQisYqmPp1InKSKFhYs6tagBYJscscdd9C2bVu+/vWv17nP3Llz+dSnPkWvXr0aMLPM2rNnD9OmTeOnP/0pJ510EgBf/OIX+ed//ue0Y1dWVvLkk0/ywAMPpB1LkiRJkmpVlvNvOx5hcM9T0g5165qegAWCo3EVg2OYO3cuq1atauw0DrFnz560nn/77bfzzjvvUFVVxYoVK1i0aBEff/xxIrmVlpZaHJAkSZKUvKoKeoX16cfZVMWYvBfTj5OjmlWB4K677qJnz55ceumlvP7667Vf/9GPfsSAAQPo27cvf//3f8+OHTt48cUXmTdvHrfccgv9+vXjT3/601H3O5ZXX32VgQMH0q9fP/r06cMbb7wBwPe+9z169+5N7969ue+++wBYt24dvXv3rn3uvffeyx133AHAsGHDuO222xg6dCj3338/f/7znxk7dix9+/alb9++vPhizQCfOXNm7fH+8R//kb179x6Sz44dO/jRj37E97//fVq3bg1Au3btao9zrBht27ZlypQp9O/fn0svvZSlS5cybNgwzj77bObNmwfAggULuPzyy4GaDo1/+Id/qN3n4MLBnXfeybnnnstll13GlVdeyb333lvn90GSJEmSAFbFblD2dHofnYsb+2Vktca5xeA3U2FTVbIxOxfDyOl1bl62bBmzZs3ij3/8I3v27KGkpIT+/fsDMG7cOL7yla8ANVfYH3vsMb72ta8xevRoLr/8csaPHw9A+/btj7pfXR5++GFuvvlmrr76anbv3s3evXtZtmwZ5eXl/P73vyfGyKBBgxg6dCgdOnQ45svbunUr//3f/w3AFVdcwdChQ5kzZw579+5l+/btrF69mtmzZ/PCCy+Qn5/PV7/6VZ566imuvfba2hhr1qyha9eutGvX7qjHOFaMjz76iGHDhnHPPfcwduxYbr/9dp599llWrVrFxIkTGT169BHxXnvtNf7rv/6Lbdu20bNnT2644QZWrlzJz372s3p9HyRJkiQ1oMpyZhU8AuUPJhLuyryeQDLzGSizUioQhBDWAduAvcCeGGNpJpPKhEWLFjF27FjatGkDcMgJ7SuvvMLtt9/O1q1b2b59O8OHDz9qjFT3O+D888/nrrvuYsOGDYwbN44ePXqwePFixo4dW3v//7hx41i0aNFRT7APdsUVV9R+/vzzz/Pkk08CkJeXx8knn8x//Md/sGzZMgYMGADAzp076dSp0zFjlpeXc//991NdXc2LL77I7373uzpjFBQUMGLECACKi4tp1aoV+fn5FBcXs27duqPGHzVqFK1ataJVq1Z06tSJP//5zyxevJgxY8ZQWFgIwN/+7d/W7l/f91eSJElSBtS286d/v39NS391+nHUIOrTQXBxjPG9RI56jCv9mVTXbPKTJk1i7ty59O3blyeeeIIFCxaktd8BV111FYMGDeLpp59m+PDhPProo8QYj7pvy5Yt2bdvX+3jXbt2HbL9QEGhLjFGJk6cyHe/+9069znnnHN466232LZtG+3ataOsrIyysjJ69+7N3r17jxkjPz+/9v1r0aIFrVq1qv28rnkRDuwDNYWMPXv21Pn6of7vryRJkqTMWBW7MbgsgdUHykfBWgsETUWzmYNgyJAhzJkzh507d7Jt2zZ++ctf1m7b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N954g6VLl7JixQqWLVvGwoULUxpbkiRJkpTtmk2BoLi4mOeee44pU6awaNEiTj755CP2KSgoqD25Ky4uZujQoeTn51NcXHzI/fOpeOCBB+jbty+DBw/m7bffrr3KXZfFixdz5ZVXkpeXx+mnn87QoUP5wx/+AMDAgQPp0qULLVq0oF+/fkfN5bOf/SwvvPACCxcu5LbbbmPhwoUsWrSIiy66KKV8x40bB0D//v3r9VoP72YACCEcc1t9v364888/n7vvvpt77rmH9evX1xY56nrPU/2+XnbZZZxyyikUFhYybtw4Fi9efMhx58+fz/z58znvvPMoKSnhtdde44033khpbEmSJElStms2BYJPfepTtZPp3XrrrXz7298+Yp/8/PzaE9IWLVrQqlWr2s/37NkD1FwJ37dvX+1zdu3adUScBQsW8Nxzz/HSSy+xcuVKzjvvvKPud7CjnRwfcCAPgLy8vNpcDnbRRRfVdg2MGTOGlStXsnjxYoYMGXLM4x5+jLri16VLly5s2LCh9vGGDRtq5zbo0qULb7/9NgB79uzhL3/5Cx07djzk6wc/59RTT2Xr1q21xz841sGuuuoq5s2bR2FhIcOHD+f5558/5nueyvcVjixGHP44xsitt97KihUrWLFiBWvWrOG6665LaWxJkiRJUrZrNgWCd955hzZt2vClL32Jr3/96yxfvvyE4hQVFbFixQr27dvH22+/zdKlS4/Y5y9/+QsdOnSgTZs2vPbaayxZsqR2W35+Ph9//PERzxkyZAizZ89m7969bNmyhYULFzJw4MCU8xoyZAgzZ86kR48etGjRgo4dO/LrX/+aCy644Ih927Vrx7Zt21KOfSxnnHEG7dq1Y8mSJcQYefLJJxkzZgwAo0ePrl2hoKKigksuuYQQAsOHD2f+/Pl88MEHfPDBB8yfP5/hw4cTQuDiiy+moqICqFnp4ECsg7355pucffbZ3HTTTYwePZqXX375mO95qp599lnef/99du7cydy5c49474YPH87jjz/O9u3bgZpbKDZv3pzY2JIkSZKkxtRoqxg0tKqqKm655RZatGhBfn4+Dz300AnFueCCC+jevTvFxcX07t2bkpKSI/YZMWIEDz/8MH369KFnz54MHjy4dtvkyZPp06cPJSUlh8xDMHbsWF566SX69u1LCIF/+Zd/oXPnzkedMPBoioqK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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L74" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test">Test<a class="anchor-link" href="#Test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      
<span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
light_curves.loglike.LogLike:  10407 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10407.000
flux            1.091
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>simulate_cells</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>&lt;lambda&gt;</code></em>)</p>
</blockquote>
<ul>
<li><code>source</code> -- a PointSource object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=100, alpha=2 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.048, 1.011: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test-combining-the-cells">Test combining the cells<a class="anchor-link" href="#Test-combining-the-cells"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cells</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="s1">&#39;Geminga&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cells</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source Geminga, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>binned exposure for source Geminga: Restoring from cache with key "binned_exposure_Geminga"<br>Weight histogram for Geminga: Restoring from cache with key "weight_hist_Geminga"<br>Loaded 3873 / 4015 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_lightcurve_demo_fig_01.png" title="images/simulation_lightcurve_demo_fig_01.png">    <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

