---

title: Simulation


keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code> and <code>beta</code> parmeters, which will be used to weight the weight distribution  by a factor</p>
<p>{% raw %}
$$ \big(1 + \alpha w + \beta \ (1-w)\ \big) $$
{% endraw %}</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="/light_curves/simulation.html#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="/light_curves/simulation.html#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Use-a--histogram">Use a  histogram<a class="anchor-link" href="#Use-a--histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weight histogram for Geminga: Restoring from cache with key &#34;weight_hist_Geminga&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABA0AAADKCAYAAADO37nyAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjMsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+AADFEAAAgAElEQVR4nO3de5zMdf//8ed7l7XLLtbpwop1iBw2xYqcW9JBpOKqrsqh5MolRUed0FldJSElsUq5Sr5XqbhKWErRzyHlQop2EUmOtc52378/ZmcuY2bX7s5ndmdnH/fbbW5r35/35z2v2X3vmM/r8z4Ya60AAAAAAADOFFHcAQAAAAAAgNBE0gAAAAAAAPhF0gAAAAAAAPhF0gAAAAAAAPhF0gAAAAAAAPhF0gAAAAAAAPhVpqieqFq1ajYxMbGong4AAAAAAOTDmjVr9lprq/s7VmRJg8TERK1evbqong4AAAAAAOSDMWZbbseYngAAAAAAAPwiaQAAAAAAAPwiaQAAAAAAAPwiaQAAAAAAAPwqsoUQAQAAAABwzOpUaf1cZ9pK6islD3KmrTDDSAMAAAAAQMmzfq60e33g7exe71zyIQwx0gAAAAAAUDLVTJIGzQ+sjdSezsQSpkIuafDHH39oz549OnnyZHGHAgBho0yZMoqOjlb16tUVHR1d3OEAAICSxsmpABLTAUqQkEoa/PHHH/rtt9+UkJCgmJgYGWOKOyQAKPGstTp16pQyMzO1fft2/eUvf1GlSpWKOywAAFCSrJ+rP7et1YbsegE31cxs05btB9SKpEGJEFJJgz179ighIUHly5cv7lAAIGwYY1S2bFnFx8erXLly2r17N0kDAABQYBuy66ndEysDbyi1p06k7wu8HUlrtx/QtaMCm57wbtQ+RUVGqJUjEYWfkEoanDx5UjExMcUdBgCErZiYGB0/fry4wwAAAHDEiaxsZYwLcE2C1Cla6VASIxyF3O4JTEkAgODhPRYAAAAFEXJJAwAAAAAAEBpIGgAAAAAAAL9IGoSYxMREde3atbjDQJgbOHAgw9QBAAAAnBVJgzAzYcIEzZw5s7jDKNWysrL09ttv68orr1TNmjUVFRWluLg4tWzZUsOHD9eqVauKO0QAAAAAyBeSBmGGpEHx2rt3r7p06aJbbrlFe/bs0dChQ/Xaa6/pueeeU6dOnTRv3jxddNFFWrFiRbHGOW3aNB09erRYYwAAAAAQ+kJqy0XAKSdPnlRWVpaio6OL7DmtterXr5+++uorTZo0SXfeeadPnQkTJig1NVXlypUrsrj8KVu2rMqWLVusMQAAAAAIfYw0KCY7duzQX//6V1WqVEkVK1ZUr169tHXrVr9133vvPfXu3Vt169ZVuXLlVK1aNfXp00fff/+9Vz1jjLZt26Zly5bJGON5ZGRkSJIWLlyo66+/Xg0aNFBMTIwqV66sHj16aNmyZQG9FmutJkyYoPPPP19xcXGqWLGimjRpottuu00nT570qvvhhx+qQ4cOio2NVWxsrDp06KB58+b5tGmM0cCBA33KZ86cKWOMli5d6ikbO3asjDHasGGD7rnnHtWpU0fR0dFauXKlp05aWpp69uypqlWrKjo6Wg0aNNBtt92mvXv3erX/3nvvqWPHjoqLi1P58uXVtm1bzZ07N18/h08++URLly7V3/72N78JA0kqU6aMbr/9drVq1cqr/Pjx43rmmWfUvHlzRUdHq3LlyurVq5e+/fZbr3pLly6VMUYzZ87UlClT1KRJE0VHRyspKUnz58+XJK1fv16XX365KlasqKpVq+quu+7y+T34W9PAXXbo0CENHTpUNWrUUHR0tDp06KBvvvnG57Xs27dPt956q6pWrarY2FilpKTo22+/VdeuXZWYmOhVN1h9DwAAAEBwMdKgGBw8eFCdO3fWjh07dMcdd6hZs2ZatmyZLrnkEr9DxidPnqwqVapoyJAhqlmzprZu3arXX39dHTp00Nq1a3XuuedKkmbNmqWRI0eqWrVqeuSRRzznV69eXZLrgnv//v3q37+/6tSpo507d+qNN95Qt27dlJaWpk6dOhXq9Tz11FMaPXq0evXqpTvuuEORkZFKT0/XRx99pOPHj3vuaE+ZMkXDhg3Teeedp0cffdRz8dunTx9NnTpVQ4YMKdTzu910002KiYnRvffeK2OMatWqJUmaOnWqhg4dqoSEBA0dOlT16tXT9u3b9fHHH+uXX35RtWrVJEmPPvqonn76aV1++eV68sknFRERoQ8++ED9+vXT5MmTNWzYsDyf351cGDx4cIHiPnnypC6//HJ9/fXXuuWWW3TnnXfq0KFDmjZtmjp06KAvvvhCycnJXue88sorOnDggAYPHqzo6GhNnDhRffr00fvvv6/bb79dN954o/r06aOFCxdq0qRJqlGjhh599NF8xXPZZZepevXqGj16tPbt26fx48fryiuvVEZGhuLi4iRJJ06cUPfu3bVu3ToNHDhQF110kb7//nt1795dVapU8WkzWH0PAAAAQJBZa4vk0bp1a3s2GzduPGudcPDQQw9ZSXbGjBle5XfffbeVZLt06eJVnpmZ6dPGxo0bbVRUlB06dKhXeb169XzOz6ud3bt326pVq9orrriiYC/iNBdeeKFt2rRpnnX2799vK1SoYBs2bGgPHTrkKT906JBt0KCBjY2NtQcOHPCUS7IDBgzwaSc1NdVKsmlpaZ6yMWPGeH5uJ0+e9Kq/Y8cOGxUVZZs2berVvltWVpa11to1a9ZYSfahhx7yqXP11VfbuLg4+8cff+T5Glu1amUl2f379/sc+/33370ep/8uxo8fbyXZTz/91OucQ4cO2XPOOcfr95mWlmYl2dq1a9uDBw96yr/77jsryRpj7P/93//5xFWzZk2vsgEDBljXn79v2Zl9as6cOVaSfe211zxlr7zyipVkn3rqKa+67vJ69ep5lQer76FwSst7LQAAcNCMK+2Kx9qGVluh1k4JJmm1zeVavmSMNPjPKGn3+uKOwlvNJOmKcYU69cMPP9Rf/vIX9e/f36v8wQcf1Msvv+xTv0KFCpJcCZ4///xTJ06cUPXq1dWkSRO/w8Zz425HkjIzM3X8+HFFRkaqbdu2XkP5C6pSpUraunWrli9fro4dO/qt8/nnn+vw4cO66667VLFiRU95xYoVNXz4cI0cOVKLFi1S3759Cx3HiBEjVKaMd5d+//33deLECY0ZM0aVK1f2OSciwjVD55133pExRgMGDPCZstC7d2/NmzdPK1asUI8ePXJ9/j/++MPzmk6XmZnpGe3hNmzYME2ePFmS9Pbbb+u8885T69atfZ770ksv1ZtvvqmjR48qJibGUz5w4EBVqlTJ8/3555+vihUrKi4uTtdee61XGx07dtTEiROVmZmp2NjYXON3GzlypNf3KSkpkqSffvrJU/bxxx8rMjJSd999t1fd22+/XQ8//LBPm8HqewAAAACCq2QkDcLMzz//rDZt2igyMtKrvFatWn4vbL/99ls99thjWrp0qQ4fPux1rH79+vl+3q1bt+qRRx7RZ599poMHD3odO3N+e0E888wz6tOnjzp16qTatWura9eu6tmzp/r27auoqChJUnp6uiSpefPmPue3aNFCkuvnEojGjRv7lLkvdC+88MI8z920aZOstTrvvPNyrfPbb7/l2YY7WfDHH38oPj7eUx4TE6PPP//c08bNN9/s89xHjx71SSycbu/evTrnnHM83zdo0MCnTnx8vFed08sl1xoE+UkanNl21apVPee7paenq3bt2j7tlS1bVvXr19eBAwe8yoPV9wAAAAAEV8lIGhTyjn4oy+1CyTUy5H+2b9+uzp07q2LFinrsscfUpEkTVahQQcYYjRgxQpmZmfl6vszMTHXu3FmHDx/WiBEjlJSUpLi4OEVEROjZZ5/VkiVLCv1aLr74Ym3dulWfffaZ0tLSlJaWptmzZ+upp57S8uXLVaVKFZ/XVVinTp3K9Vj58uV9ytzPe7YLU2utjDH6z3/+45PMcfOX8DhdixYttHbtWq1bt06XXHKJpzwyMlLdu3eXJM+ilGc+d1JSksaPH59r22cmFHKLMbdy9/PkR25tnH5+QX6fwex7AAAAAIKrZCQNwkyDBg30448/Kisry+sC7ddff9WhQ4e86n7wwQfKzMzURx995HUhKrnu/J65dV9uF8eLFy/Wrl27NGPGDA0aNMjrWH4XyMtLbGysrrvuOl133XWS/rfo4fTp03X//ferYcOGkqQNGzaoW7duXudu3LhRkvcd7ipVqmj//v0+z1PQ0QhNmjSR5Bqt4V4w0p9zzz1Xn376qerWraumTZsW6Dnc+vbtq7feektvvPGGz+8qL+eee65+//13paSkeKZLhLr69etr0aJFPlMeTp48qfT0dK8RM8HuewAAAACCp2RcoYSZq6++Wr/99pveeustr/LnnnvOp647qXDmnd1p06Zp9+7dPvVjY2P9Xmzn1s7ChQsLtC6CP2fOw5fk2VLQHcull16qChUqaNKkSfrzzz899f78809NmjRJsbGxuvTSSz3ljRs31ooVK3TkyBFP2YEDB5Samlqg2NxTJB5//HHPmgOnc/88brnlFknSww8/rKysLJ96e/bsOetzXXXVVerSpYtmz57tWa8gt+c7Xf/+/bV79+5cRxqcbVpEcejVq5eysrJ81uCYNm2aT+IrmH0PAAAAQHAx0qAYPPDAA5o9e7Zuv/12rVmzRs2bN9fSpUu1YsUKz/Z/bldccYXKly/v2YovPj5eX331lRYsWKCGDRv6DNdv166dpk+frscee0xNmzZVRESEevXqpY4dO6pmzZq69957lZGRoTp16mjdunWaNWuWkpKStH6990KTS5cu1SWXXKIBAwZo5syZeb6epk2bql27dmrbtq1q166tX3/9Va+//rqioqJ0ww03SJIqV66s559/XsOGDVPbtm01cOBASa6t+LZs2aKpU6d6Lex355136uabb1ZKSopuueUWHTx4UNOmTVO9evX8JktyU6dOHU2YMEHDhg1TUlKS+vfvr3r16mnnzp2aN2+eZsyYoQsuuEBt2rTR448/rjFjxuiCCy5Qv379PK9lzZo1WrBggU6cOJHncxljNHfuXPXp00fDhw/XzJkz1atXL51zzjk6cuSItm7dqjlz5kiSEhMTPefdfffd+vzzz3X//fdryZIlSklJUcWKFbV9+3YtXrxY0dHRSktLy/drLgqDBw/W1KlT9eijj2rLli2eLRfnzJmjRo0aefXLgvY9AAAAAKGDpEExiI+P15dffql77rlHb731lqy16tq1q9LS0nyG7jds2FD/+c9/9PDDD+uZZ55RZGSkOnTooGXLlunOO+/0mSP/9NNPa//+/XrllVd08OBBWWuVnp6uxMREffbZZ3rggQc0adIknTp1Sq1bt9aCBQs0ffp0nws392iAhISEs76ee++9VwsWLNDEiRN16NAh1ahRQ+3atdNDDz2kli1beur94x//UK1atfTPf/5Tjz/+uCSpZcuW+uCDD9SnTx+vNm+66Sbt2rVLkydP1j333KMGDRpo9OjRioiIKPDd6aFDh6phw4b65z//qYkTJ+r48eOqXbu2unXr5rVw4OjRo9W6dWtNnDhREyZM0OHDh1WjRg21aNHC764W/lSrVk1Lly7Vv/71L82ePVtTpkzR/v37FR0drfr166tPnz4aNGiQkpOTPeeULVtW8+fP15QpUzRr1iyNGTNGklS7dm1ddNFFGjBgQIFeb1EoV66cFi9erPvvv1/z5s3TnDlz1LZtWy1evFiDBw/2GiFSuXLlAvU9AAAAAKHDOLVA3dkkJyfb1atX51ln06ZNhZ5PDmfdc889Sk1N1datW1WlSpXiDgclRFZWlqpVq6a2bdvq008/Le5wkAveawEAQIGl9tTK9H1q94QD22U71VaotVOCGWPWWGuT/R1jTQP49dlnn+nRRx8lYYBcHT161Kfs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mjdv7nOsWbNmioiI0M8//+xzrEGDBl7fV61aVVL+Xrf7gt09PSQtLU0pKSm65JJLZIzRkiVLlJ2drWXLlqlr166OTPMIJN6CKF++vCTXVodnOnbsmFcd97/91XXXP7NusNrOzTPPPKPo6Gh16tRJCQkJuummmzR79mydOHHCq15B+2etWrU8iQ63wvxN+Zt206xZM0ny22/dNm/erOzsbE2fPl3Vq1f3eWzevNmzS0ZUVJQmTJig//73v6pfv76aN2+u4cOHa/Hixbm2DwAAABRWvrZchLOuvvpqZWRkaMGCBVq2bJkWLVqk6dOnq1OnTlq0aJGioqLyPD8yMrLAx1wjTlzy2sbx1KlTZ4nedee2c+fOOnz4sEaMGKGkpCTFxcUpIiJCzz77bL7XZjhbnAWRn9edmzZt2qhixYpasmSJLr30Um3fvl0pKSmqUqWKWrZsqcWLF6tp06bav39/nusZFFW8BVG7dm1JrnUazuQuO30Rw9q1a/ut665/Zt1gtZ2biy++WFu3btVnn32mtLQ0paWlafbs2Xrqqae0fPlyValSpVD9M9C/KTd/f1v5+Z2669x8880aMGCA3zoxMTGef99xxx26+uqrNX/+fC1btkxz587V5MmTdf311+vdd9896/MBAAAA+cX0hGJSpUoV3XzzzZo2bZp+/vlnPfDAA/ryyy81b968InluybUC++mOHTvmGYqfl8WLF2vXrl166aWXNHbsWF133XXq0aOHunfvrsOHD/vUzytJcSb3HfgNGzb4HPvhhx+UnZ3tc5c+UJGRkerUqZPS0tI8SZuOHTtKkrp166bFixcrLS1NkvKVNCjI6w22Nm3aSJJWrFjhc2zlypUyxqh169Ze9Xfu3KkdO3Z41d2xY4d27dql5OTkImk7L7Gxsbruuus0efJkbdiwQa+88oo2bdqk6dOnSyp4/3TSxo0bfcrcu5fk1W8bNWokY4xOnDih7t27+3106NDB65xatWpp8ODBmjVrln755RfdeOONeu+99/K1oCQAAACQXyQNilhWVpYOHjzoVWaM0YUXXijJ90I+GBo3bixJWrRokVf5Sy+9lK8pEu47r2feQV24cKHf+eKxsbE6cOBAvu641qhRQ+3bt9fHH3/steaDtVbPPvusJOmaa645azsFlZKSon379mnixIlq166dZ6h8SkqKtm/frhkzZqhmzZqeoeZ5iY2NlVQ0v8uzadSokZKTk/X+++9r165dnvJdu3bp/fffV0pKimrWrOkpv/HGGyW5ptCczv39TTfdVCRt52bv3r0+Za1atZL0v593Qfunk9555x398ssvnu9PnDihl156SZGRkbrqqqtyPa9q1aq68sor9e9//1srV670OW6t1e+//y7JtTbEmes/REZGetYACYV+BwAAgPDB9IQi9ueff6pWrVrq3bu3LrzwQtWoUUPp6el69dVXFR8fr169egU9hu7du+u8887zbPdXv359LV++XCtXrlS1atXOen7Hjh1Vs2ZN3Xvvvbl138wAABlYSURBVMrIyFCdOnW0bt06zZo1S0lJSVq/fr1X/Xbt2umTTz7RnXfeqfbt2ysyMlIpKSmqUaOG3/ZffvlldenSRZ06dfJsufjJJ5/os88+09/+9jd169bNkZ/D6dwjCDZt2qTrr7/eU965c2eVKVNGGzdu9Fz0nk27du00efJk/eMf/1DPnj1VtmxZtW3b1u9aFIU1efJkT/Lp5MmT2rZtm5566ilJUsuWLb360csvv6xLLrlEnTp18iz2N2nSJGVnZ+vFF1/0ardnz5666qqrNH78eB06dEgXX3yxVqxYoenTp+vmm2/2jMAoirb9adq0qdq1a6e2bduqdu3a+vXXX/X6668rKipKN9xwg6SC908nNW7cWG3bttUdd9yhuLg4zZ49W6tWrdJjjz3ms9XkmV599VV17NhRnTt3Vv/+/XXhhRcqOztbP//8s+bNm6f+/ftr7Nix+vHHH9WlSxddc801atGiheLj47Vp0ya9+uqrql+/vs92kgAAAEBActtWwekHWy66HD9+3I4aNcq2adPGVqlSxUZFRdl69erZQYMG2R9//NH7OfK5/aG1uW+jmJ6ebiV5tmtz27x5s73ssstsTEyMrVSpku3Xr5/95Zdf8v2c3333nb3sssts5cqVbWxsrO3SpYv94osv/G4ll5mZaW+99VZbo0YNGxERYSXZtLQ0a23u2xOuW7fOXn311TY+Pt5GRUXZ8847zz733HP21KlTXvXy2t5Qkh0wYIDfY2fKzs621apVs5LsF1984XWsffv2VpKdNm2az3n+nj8rK8vee++9NiEhwfN6U1NTHY3XvfWmv4e/Nr7++mubkpJiK1SoYGNjY22PHj28to483dGjR+0jjzxi69Wr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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L74" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test">Test<a class="anchor-link" href="#Test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      
<span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
light_curves.loglike.LogLike:  10475 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10475.000
flux            1.106
sig_flux        0.017
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>simulate_cells</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>&lt;lambda&gt;</code></em>)</p>
</blockquote>
<ul>
<li><code>source</code> -- a PointSource object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=100, alpha=2 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.035, 1.008: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fit</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">fit</span> <span class="ow">in</span> <span class="n">pfits</span> <span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">();</span> <span class="nb">round</span><span class="p">(</span><span class="n">ee</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>47.7</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_fits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pfits</span><span class="p">)</span>
<span class="n">df_fits</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.930[1+0.086-0.090], &lt; 3.39</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.012[1+0.084-0.089], &lt; 3.48</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.118[1+0.083-0.087], &lt; 3.59</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3.307[1+0.080-0.084], &lt; 3.79</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3.059[1+0.083-0.088], &lt; 3.52</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>9995</th>
      <td>2.966[1+0.086-0.090], &lt; 3.43</td>
    </tr>
    <tr>
      <th>9996</th>
      <td>3.072[1+0.083-0.087], &lt; 3.54</td>
    </tr>
    <tr>
      <th>9997</th>
      <td>3.084[1+0.083-0.087], &lt; 3.55</td>
    </tr>
    <tr>
      <th>9998</th>
      <td>3.364[1+0.079-0.083], &lt; 3.85</td>
    </tr>
    <tr>
      <th>9999</th>
      <td>3.045[1+0.083-0.088], &lt; 3.51</td>
    </tr>
  </tbody>
</table>
<p>10000 rows  1 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test-combining-the-cells">Test combining the cells<a class="anchor-link" href="#Test-combining-the-cells"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="s1">&#39;Geminga&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source Geminga, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>binned exposure for source Geminga: Restoring from cache with key "binned_exposure_Geminga"<br>Weight histogram for Geminga: Restoring from cache with key "weight_hist_Geminga"<br>Loaded 3873 / 4015 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_lightcurve_demo_fig_01.png" title="images/simulation_lightcurve_demo_fig_01.png">    <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

