---

title: Simulation


keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>_WeightGenerator</code> class accepts <code>alpha</code> and <code>beta</code> parmeters, which will be used to weight the weight distribution  by a factor</p>
<p>{% raw %}
$$ \big(1 + \alpha w + \beta \ (1-w)\ \big) $$
{% endraw %}</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is done by <a href="/light_curves/simulation.html#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="/light_curves/simulation.html#simulate_cells"><code>simulate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- a function, a histogram, or a fixed value<br>
  If a function, must be positive definite.<br>
  Assume histogram bins are 0 to 1.</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram or value)</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Gaussian-and-quadratic-example-functions">Gaussian and quadratic example functions<a class="anchor-link" href="#Gaussian-and-quadratic-example-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Use-a--histogram">Use a  histogram<a class="anchor-link" href="#Use-a--histogram"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">));</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weight histogram for Geminga: Restoring from cache with key &#34;weight_hist_Geminga&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAd0AAAD9CAYAAAD55q3sAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjMsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+AADFEAAAgAElEQVR4nO3deXxU1f3/8ddJICSSQAIBIgkJmyDwjVgMFpCK+hUXqNpikKWgIrhTodKfbBYRWVXU+qVaqRasWhFxQS3f0q9YBKwgiCAgAoJJMClC2MKShCXn98eEKQkzmSEzcyfL+/l4zCPhnnvvfOaQ5HPPueeeY6y1iIiISOhFhDsAERGR2kJJV0RExCFKuiIiIg5R0hUREXGIkq6IiIhD6oT6DRITE23Lli1D/TYiIiJVxpdffplvrW1SfnvIk27Lli1Zt25dqN9GRESkyjDGZHvaru5lERERhyjpioiIOERJV0RExCFKuiIiIg4J+UCqihQUFLB3715OnjwZzjBE5Cz169cnJSWFiAhdk4sEW9iSbkFBAT/++CPJycnExMRgjAlXKCJSqqSkhNzcXPLz82natGm4wxGpccJ2Kbt3716Sk5O54IILlHBFqoiIiAiaNWvG4cOHwx2KSI0UtqR78uRJYmJiwvX2IuJF3bp1OXXqVLjDEKmRwnpPVy1ckapHv5dSraybB5sWVbxPeiZkDHMmHh80UkJERKqvTYtgzybv5Xs2+U7KDgprS7c6ufPOO0lJSWHq1KnhDkXKmT59Ort27eLll18OdygiEg5J6TDsb57L5vV1NhYflHRD4KqrrmLIkCGMGDEi3KGEzYIFC3j22WfZvHkz9evXp1WrVtxxxx3cf//9Qe++nDBhQlDPJyIOCkL38Pqcg/Qb5znpLojaT1RkBF0CiTGIfCZdY8xVwD89FB221sYHPSIJi9OnTxMZGRmUc82ePZsnn3ySP/zhD1x//fXExsayYcMGnn76aYYPH069evWC8j4iUgOc6R5OSvdcfqbruIKke+J0CVkzvbRo573A6u/3Bxhk8JzPPd2HgO5nva4NSURVxFdffUWXLl2Ii4tjwIABFBUVucsOHjzIz3/+c5o0aUJCQgI///nP+eGHHwCYOHEiK1euZOTIkcTGxjJy5EgARo0aRYsWLWjQoAGXXXYZK1eu9DuWWbNmkZycTFxcHO3bt2fZsmUAFBcXM3r0aJo3b07z5s0ZPXo0xcXFAMyfP5+ePXuWOY8xhu+++w5wdZfff//99OnTh/r16/PPf/6TwsJCxowZQ1paGg0bNqRnz54UFhYCsHr1anr06EF8fDydO3dm+fLlHmM9fPgwkyZN4oUXXiAzM5O4uDiMMfzkJz/hjTfecCfc4uJifvvb35KamkqzZs2477773O+1fPlyUlJSePLJJ2natCkXXngh77//PkuWLKFdu3Y0atSI6dOnu99z8uTJDBkyBICsrCyMMbz66qukpqaSmJjItGnT3PsWFhZyxx13kJCQQIcOHXjyySdJSUlxl8+cOZM2bdoQFxdHx44dee+99/z+fxKRSjrTPezp5S0ZV1Pn07281Vq7OmSR/O+4im+GB0NSOtw40+duJ06c4Be/+AWjR49m5MiRLF68mEGDBjF27FjANYHAsGHDWLhwIadPn+auu+5i5MiRvP/++0ybNo3PPvvsnO7lrl27MmnSJBo2bMjvf/97+vfvT1ZWFtHR0RXGsm3bNubMmcPatWtp3rw5WVlZnD59GoBp06axevVqNmzYgDGGW265halTp/LEE0/4VR1//etfWbJkCR999BEnTpxgzJgxbNmyhX/9618kJSWxZs0aIiIiyM3NpW/fvrz22mvccMMNLFu2jFtvvZVvv/2WJk3KLhf5+eefU1xczC233FLhe48dO5Zdu3axYcMG6taty+DBg5kyZQozZswAYM+ePRQVFZGbm8v8+fO5++676d27N19++SU5OTlcdtllDBw4kNatW3s8/6pVq9i2bRvbt2/n8ssvp1+/fnTo0IHHH3+crKwsdu3axbFjx+jTp0+Z49q0acPKlStJSkri7bffZsiQIXz33XdceOGFftWpiJy/6tQ9HCiNXvZg9erVnDx5ktGjR1O3bl0yMzPp2rWru7xx48bceuutXHDBBcTFxTFx4kQ+/fTTCs85ZMgQGjduTJ06dRgzZgzFxcVs27bNZyyRkZEUFxfzzTffcPLkSVq2bEmbNm0AeOONN5g0aRJNmzalSZMmPPbYY7z22mt+f85bbrmFK664goiICKKiovjzn//M73//e5KTk4mMjKRHjx7Uq1eP119/nT59+tCnTx8iIiLo3bs3GRkZLFmy5Jxz5ufnk5iYSJ06/7meO9NCjomJYcWKFVhr+dOf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dtttPPDAA/ziF784p/zBBx8kKiqKH3/8kQ0bNtC3b186d+5Mp06dyM/Pp1+/frz88svcdNNN/O53v2PAgAGsXu2aBm7u3Lm8//77bNy4EWMMvXv3pnXr1tx3332AayGJ7t27s2TJEpYsWUJmZiY7duygOi7eISJVi7qXvZg1axbJycnExcXRvn17li1bBsDkyZPdK/lkZWVhjGHevHm0aNGChIQE/vjHP7J27VouueQS4uPjy0wxePaxZx9/6tSpc95/586dXHPNNTRu3JjExER+9atfcejQIQCGDh1KTk4ON910E7GxsTz55JPnnCsvL4+bb76ZRo0a0bZtW/70pz+VieO2227j9ttvdy8K72l+bHAtBv/rX/8acK2hW79+fR555BEACgsLiY6O5uDBg2Xef+LEiaxcuZKRI0cSGxtbpg4+/vhjLrroIhISEnjwwQe9LpvXvn17hg8fTqdOnc4pO3bsGO+88w5PPPEEsbGx9OzZk5tvvpnXXnsNgHfffZdOnTrRv39/oqOjmTx5Mhs3buTbb78F4NVXX2XMmDGkpKSQnJzMmDFjmD9/PgDbt29n/fr1PP7448TExHDrrbeSnp7OO++84zHOL774goyMDBo0aECzZs14+OGH3WX9+/cnKSmJhg0bcuWVV7JlyxZ32Z133skDDzzAjTfeSGxsLFdccQV79uxh9OjRJCQkcPHFF/PVV1+592/ZsiUzZsygY8eOJCQkMGzYMIqKijzGlJeXx6233kqTJk1o1aoVzz//vF/xikjoKel6sG3bNubMmcPatWs5cuQIS5cupWXLll73X7NmDTt27OCtt95i9OjRTJs2jY8//pgtW7awcOHCSk2mb61l/Pjx5OXlsXXrVnbv3u1enu+1114jNTWVDz/8kKNHj7qT4NkGDRpESkoKeXl5LFq0iAkTJrgvHAA++OADBg4cyKFDh7j55pu9zj/cq1cvli9fDsDatWtJSkpyf57PP/+c9u3bk5CQUOaYadOm8bOf/Yw5c+Zw9OjRMsvnffTRR6xdu5aNGzeycOHCSi3nt337diIjI2nXrp1725mlDAG2bNlC586d3WX169enTZs2XsvLH9u6dWvi4uI8lpc3atQoRo0aRUFBATt37uS2225zl914443s2LGDvXv30qVLF371q1+VOXbhwoVMnTqV/Px86tWrR/fu3enSpQv5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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L74" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test">Test<a class="anchor-link" href="#Test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      
<span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
light_curves.loglike.LogLike:  10386 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10386.000
flux            1.067
sig_flux        0.016
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="simulate_cells" class="doc_header"><code>simulate_cells</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L128" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>simulate_cells</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>wdist</code></strong>=<em><code>None</code></em>, <strong><code>source_flux</code></strong>=<em><code>&lt;lambda&gt;</code></em>)</p>
</blockquote>
<ul>
<li><code>source</code> -- a PointSource object, use to get exposure at its position and weight distribution</li>
<li><code>wdist</code>   -- a weight function or histogram; if None, get the source distribution</li>
<li><code>source_flux</code> -- function of MJD time for the counts/day; default 100/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="n">simcells</span> <span class="o">=</span> <span class="n">pfits</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">funstr</span><span class="o">=</span><span class="s1">&#39;(x-0.5)**2&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N:,} cells with mu={mu}, alpha={alpha} using the function {funstr}</span>

<span class="sd">    The deviations from the expected norm divided by each cell&#39;s average error:</span>
<span class="sd">    {fig1}</span>
<span class="sd">    Mean and STD of this distribution: {m:.3f}, {sig:.3f}: for a generated Gaussian distribution these wouild be 0 and 1. </span>
<span class="sd">    </span>
<span class="sd">    A validation of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span>

    <span class="n">wfun</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;lambda x: </span><span class="si">{</span><span class="n">funstr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">simcells</span><span class="p">,</span> <span class="n">pfits</span> <span class="o">=</span>  <span class="n">local_sim_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    
    <span class="n">m</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h3><p>Generate 10,000 cells with mu=50, alpha=0 using the function (x-0.5)**2</p>
<p>The deviations from the expected norm divided by each cell's average error:</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_test_fig_01.png" title="images/simulation_test_fig_01.png">    <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300>   </a> </figure>
</div><p>Mean and STD of this distribution: -0.101, 1.038: for a generated Gaussian distribution these wouild be 0 and 1.</p>
<p>A validation of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/simulation_test_fig_03.png" title="images/simulation_test_fig_03.png">    <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Follow-on:-combine-the-cells-and-fit-the-result">Follow-on: combine the cells and fit the result<a class="anchor-link" href="#Follow-on:-combine-the-cells-and-fit-the-result"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cells</span><span class="o">=</span><span class="p">[]</span>
<span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="s1">&#39;Geminga&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">cells</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">simulate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source Geminga, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details  class="nbdoc-description" >  <summary> Print out </summary>  <div style="margin-left: 5%"><pre>binned exposure for source Geminga: Restoring from cache with key "binned_exposure_Geminga"<br>Weight histogram for Geminga: Restoring from cache with key "weight_hist_Geminga"<br>Loaded 3873 / 4015 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details></p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/simulation_lightcurve_demo_fig_01.png" title="images/simulation_lightcurve_demo_fig_01.png">    <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500>   </a> </figure>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

