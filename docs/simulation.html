---

title: Simulation


keywords: fastai
sidebar: home_sidebar

summary: "Generate simulated cells using the weighted likelihood"
description: "Generate simulated cells using the weighted likelihood"
nb_path: "nbs/10_simulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_simulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For simulation the distribution of weights is required. That can be a histogram or a function, an input to the <code>_WeightGenerator</code> class. The class is a functor, with the argument a number on the range (0,1).  Passing an array of uniform random numbers then creates set of weights distributed according to the model represented by the input weight distribution.</p>
<p>To account for different levels of signal or background than that represented by the full dataset, the <code>WeightGenerator</code> class accepts <code>alpha</code> and <code>beta</code> parmeters, which will be used to weight the weight distribution  by a factor</p>
<p>{% raw %}
$$ \big(1 + \alpha w + \beta (1-w)\ \big) $$
{% endraw %}</p>
<p>Generating a cell requires also the expected number of photons. If the average flux and exposure predict a number of events $\mu$, we select the actual number from the Poisson distribution.</p>
<p>This is encapsulated by <a href="/light_curves/simulation.html#generate_cell"><code>generate_cell</code></a>, which creates a list of weights depending on $\alpha$, $\beta$, and $\mu$.</p>
<p>Finally, <a href="/light_curves/simulation.html#generate_cells"><code>generate_cells</code></a> makes a list of cells, based on the actual exposure of a source.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="_Sampler" class="doc_header"><code>class</code> <code>_Sampler</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L17" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>_Sampler</code>(<strong><code>func</code></strong>, <strong><code>limits</code></strong>=<em><code>(0, 1)</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>)</p>
</blockquote>
<p>Sample an arbitrary function or histogram</p>
<ul>
<li>func -- the function, or a histogram</li>
<li>a,b  -- limits (default 0,1)</li>
<li>n    -- table size (ignored if a histogram)</li>
</ul>
<p>Note the property <code>mean</code> is the expected mean.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="_Sampler-tests:--Gaussian-and-quadratic-functions"><code>_Sampler tests</code>:  Gaussian and quadratic functions<a class="anchor-link" href="#_Sampler-tests:--Gaussian-and-quadratic-functions"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">tests</span><span class="o">&lt;</span><span class="mf">5e-2</span> <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed Tests: mean </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">}</span><span class="s1">, std </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="n">wfun</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="n">test2</span> <span class="o">=</span> <span class="n">wfun</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wfun</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test-_Sampler-with-a-histogram">Test <code>_Sampler</code> with a histogram<a class="anchor-link" href="#Test-_Sampler-with-a-histogram"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.weights</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
    <span class="n">sf</span> <span class="o">=</span> <span class="n">_Sampler</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">sf</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;simulation with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">h</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">),</span>
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;data, source </span><span class="si">{</span><span class="n">source</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Weight histogram for Geminga: Restoring from cache with key &#34;weight_hist_Geminga&#34;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAArkAAAD4CAYAAADoxf5UAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4xLjMsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+AADFEAAAgAElEQVR4nO3dfXRU1b3/8c9OSCBICuFJVIRgpShleAjDkzwWq4BwQ2GlSxQFsmhZ2Fr13lsLuijF+gS9tFe5LSCKQYU2/BoLRWktKhd5UIqJBoNAf3IhYFAuNog8BWOS/fsjkB9IQs6ZzJnMnHm/1mJJMvuc883swXxmzz57G2utAAAAAD9JaOwCAAAAgHAj5AIAAMB3CLkAAADwHUIuAAAAfIeQCwAAAN9p4sVJ27Zta9PT0704NQAAACBJKigo+Ke1tl1tj3kSctPT05Wfn+/FqQEAAABJkjHmYF2PMV0BAAAAvkPIBQAAgO8QcgEAAOA7nszJrc1XX32lkpISnT17NlKXBKJCs2bN1LFjRyUlJTV2KQAAxI2IhdySkhKlpqYqPT1dxphIXRZoVNZalZaWqqSkRF26dGnscgAAiBsRm65w9uxZtWnThoCLuGKMUZs2bfgEAwCACIvonFwCLuIRr3sAACKPG88AAADgO3EbcufNm6eFCxdets3atWu1e/fuCFUUGRUVFXr44YfVtWtX9e7dW71799bjjz8elnPn5+frvvvuC8u5AAAAGiJiN57ForVr12rcuHHq3r17Y5dSo6KiQk2ahN5tc+bM0ZEjR1RUVKRmzZrp5MmT+vWvfx2W2oLBoILBYFjOBQBAvBg8f6MOHy9z3P6aVinaNnukhxX5Q1yF3Mcff1wvvviirr32WrVr1059+/aVJD377LNatmyZysvLdf311+ull15SYWGh1q1bp7feekuPPfaYXn75ZW3cuPGSds2bN6/zeh9++KGys7NVXl6uqqoqvfzyy+ratat+85vf6Pnnn5ck/eAHP9ADDzyg4uJijRs3Trt27ZIkLVy4UKdOndK8efM0YsQI3XTTTdq2bZsyMzN11113aebMmdq/f78kacmSJbrpppu0cuVKLVq0SOXl5RowYIAWL16sxMTEmnrOnDmjZ599VsXFxWrWrJkkKTU1VfPmzatpU9c5WrRooR//+Md64403lJaWpieeeEI/+9nPdOjQIT311FPKzMzUpk2btHDhQr366quaN2+eDh06pP379+vQoUN64IEHakZ5H330Ua1atUrXXnut2rZtq759++qnP/1prf1wuecXAAA/OHy8TMXzxzpunz57vfOT5+dIRXnuiwpkScFs98dFkcYJuX+dLR0pCu85OwSkMfPrfLigoEC5ubl6//33VVFRoYyMjJqQO3HiRP3whz+UVD3SuXz5cv3kJz9RZmamxo0bp6ysLElSq1atam1Xl6VLl+r+++/X5MmTVV5ersrKShUUFCgnJ0d///vfZa3VgAEDNHz4cKWlpV32xzt+/LjeeustSdLtt9+u4cOHa82aNaqsrNSpU6e0Z88erV69Wtu2bVNSUpJ+9KMfadWqVZoyZUrNOfbt26dOnTopNTW11mtc7hynT5/WiBEjtGDBAk2YMEFz5szR66+/rt27d2vq1KnKzMy85Hx79+7Vf//3f+vkyZPq1q2b7rnnHu3cuVMvv/yyq34AAAAhKsqrzlwdAs6POZ/RCLmxYcuWLZowYULNyOCFoWzXrl2aM2eOjh8/rlOnTmnUqFG1nsNpu/MGDRqkxx9/XCUlJZo4caK6du2qrVu3asKECbriiiskVQe7LVu21BoSL3T77bfX/H3jxo168cUXJUmJiYlq2bKlXnrpJRUUFKhfv36SpLKyMrVv3/6y58zJydHTTz+t0tJSvf3223rzzTfrPEdycrJGjx4tSQoEAmratKmSkpIUCARUXFxc6/nHjh2rpk2bqmnTpmrfvr3+93//V1u3btX48eOVkpIiSfqXf/mXmvZun18AAOBAh4CU7WL0N8f5qHI0a5yQe5kRVy/VtZTTtGnTtHbtWvXq1UsrVqzQpk2bGtTuvDvvvFMDBgzQ+vXrNWrUKD333HOy1tbatkmTJqqqqqr5+uvrqp4PxXWx1mrq1Kl68skn62xz/fXX69ChQzp58qRSU1OVnZ2t7Oxs9ejRQ5WVlZc9R1JSUs3zl5CQoKZNm9b8vaKiotbrnW8jVYfxioqKOn9+yf3zCwBAzMvPUW7yM1LOYseH3JHYTZI/gqiX4mZ1hWHDhmnNmjUqKyvTyZMn9corr9Q8dvLkSV111VX66quvtGrVqprvp6am6uTJk/W2W7NmjR566KFLrrl//35dd911uu+++5SZmakPPvhAw4YN09q1a3XmzBmdPn1aa9as0dChQ3XllVfq6NGjKi0t1ZdffqlXX321zp/l5ptv1pIlSyRJlZWVOnHihG6++Wbl5eXp6NGjkqRjx47p4MGDFx3XvHlzTZ8+Xffee29NiK6srFR5eXnNees7R0MNGTJEr7zyis6ePatTp05p/fr//86yrucXAADfKspTd+Pid+2RIo1PfNu7enwkbqYrZGRk6Pbbb1fv3r3VuXNnDR06tOaxRx99VAMGDFDnzp0VCARqgu2kSZP0wx/+UIsWLVJeXl6d7f7nf/5H3/jGNy655urVq7Vy5UolJSWpQ4cOmjt3rlq3bq1p06apf//+kqpvPOvTp48kae7cuRowYIC6dOmiG264oc6f5emnn9aMGTO0fPlyJSYmasmSJRo0aJAee+wx3XrrraqqqlJSUpJ+97vfqXPnzhcd+/jjj+vnP/+5evToodTUVKWkpGjq1Km6+uqrlZyc7OgcDdGvXz9lZmaqV69e6ty5s4LBoFq2bCmp7n4AAMDPdtvOGuh0OkHOWOlAqbcF+YS53MfHNY2MKZZ0UlKlpApr7WXXiQoGgzY/P/+i7+3Zs0c33nhj6JVGsbvuukv/+Z//qXbt2jV2KTHh1KlTatGihc6cOaNhw4Zp2bJlysjIaOyyPOXn1z8AoAFyxmr7gVIN/OV2z9pLCm1OrptjGokxpqCuXOpmJPc71tp/hqkmX1m5cmVjlxBTZsyYod27d+vs2bOaOnWq7wMuAACN6b1Dn2uii2XHcpNLlZyYoFj/7Rw30xUQPX7/+983dgkAAMSN8soqV+vwKmextvtgSoTTG8+spA3GmAJjzAwvCwIAAAAayulI7mBr7SfGmPaSXjfG7LXWbr6wwbnwO0OSOnXqFOYyAQAAAOccjeRaaz8599+jktZI6l9Lm2XW2qC1NsgNWAAAAGhM9YZcY8wVxpjU83+XdKukXV4XBgAAAITKyXSFKyWtObfbVRNJv7fWvtbQCw+ev1GHj5c19DQ1rmmVom2zR7o+7gc/+IH+7d/+Td27d29wDenp6crPz1fbtm3rbPPEE0/o4Ycfrvn6pptu0ttve7+o89KlS9W8eXNNmTJFK1as0K233qqrr77acd2lpaXKysrSu+++q2nTpum3v/1tzWMFBQWaNm2aysrKdNttt+npp5+WMUZffvmlpkyZooKCArVp00arV69Wenq6JOmFF17QY489JkmaM2eOpk6dKkk6cOCAJk2apGPHjikjI0MvvfSSkpOTPXpWnGnRooVOnTrVqDUAAAB36g251tr9knqF+8KHj5e5u9OvHukulsa40HPPPRe2Gpz4esiNRMCVpJkzZ9b8fcWKFerRo0dNyHWiWbNmevTRR7Vr1y7t2nXxQP4999yjZcuWaeDAgbrtttv02muvacyYMVq+fLnS0tK0b98+5ebmatasWVq9erWOHTumRx55RPn5+TLGqG/fvsrMzFRaWppmzZqlf/3Xf9WkSZM0c+ZMLV++XPfcc0/YngcAABAf4mZb39OnT2vs2LHq1auXevToodWrV0uSRowYofMbV7Ro0UKzZs1S37599d3vflc7duzQiBEjdN1112ndunWSqgPivffeW3PecePGadOmTZdc73vf+5769u2rb3/721q2bJkkafbs2SorK1Pv3r01efLkmmtKkrVWDz74oHr06KFAIFBT36ZNmzRixAhlZWXphhtu0OTJk/X1DTyOHj2qvn37SpJ27twpY4wOHTokSfrmN7+pM2fOaN68eVq4cKHy8vKUn5+vyZMnq3fv3iorqx5N/6//+i9lZGQoEAho7969l/w8V1xxhYYMGaJmzZpd9P1PP/1UJ06c0KBBg2SM0ZQpU7R27VpJ0p///OeaEdqsrCy9+eabstbqb3/7m2655Ra1bt1aaWlpuuWWW/Taa6/JWquNGzcqKytLkjR16tSac13oww8/VP/+/dW7d2/17NlTH330UZ3PuZt+HT9+vEaPHq1u3brpkUceueS6kvQf//Ef6tevn3r27Klf/OIXkup+bQEAgMYTNyH3tdde09VXX62dO3dq165dGj169CVtTp8+rREjRqigoECpqamaM2eOXn/9da1Zs0Zz5851db3nn39eBQUFys/P16JFi1RaWqr58+crJSVFhYWFWrVq1UXt//SnP6mwsFA7d+7UG2+8oQcffFCffvqpJOn999/XU089pd27d2v//v3atm3bRce2b99eZ8+e1YkTJ7RlyxYFg0Ft2bJFBw8eVPv27dW8efOatllZWQoGg1q1apUKCwuVkpIiSWrbtq3ee+893XPPPVq4cKHjn/Pw4cPq2LFjzdcdO3bU4cOHax679tprJUlNmjRRy5YtVVpaetH3LzymtLRUrVq1UpMmTS4514WWLl2q+++/X4WFhcrPz6+5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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="_WeightGenerator" class="doc_header"><code>class</code> <code>_WeightGenerator</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L57" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>_WeightGenerator</code>(<strong><code>func</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>, <strong><code>n</code></strong>=<em><code>100</code></em>) :: <code>_Sampler</code></p>
</blockquote>
<p>Generate a set of weights</p>
<ul>
<li><code>func</code> -- nominal weight distribution function, evaluated on (0,1)</li>
<li><code>alpha, beta</code> -- (default 0,0). Values for $\alpha$, $\beta$.</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test--_WeightGenerator">Test  <code>_WeightGenerator</code><a class="anchor-link" href="#Test--_WeightGenerator"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>      
<span class="n">wg</span> <span class="o">=</span> <span class="n">_WeightGenerator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">test2</span> <span class="o">=</span> <span class="n">wg</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wg</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="n">test2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">test2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Not almost equal: </span><span class="si">{</span><span class="n">test2</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cell" class="doc_header"><code>generate_cell</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L74" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cell</code>(<strong><code>wfun</code></strong>, <strong><code>mu</code></strong>, <strong><code>alpha</code></strong>=<em><code>0</code></em>, <strong><code>beta</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>Generate a cell</p>
<ul>
<li><code>wfun</code> -- weight function, or histogram.
  Defined on (0,1)</li>
<li><code>mu</code> -- number of expected weights, on average</li>
<li><code>alpha</code>, <code>beta</code>  -- default 0,0; values for $\alpha$ and  $\beta$ for this cell</li>
</ul>
<p>Returns a dict with:</p>
<ul>
<li><code>n</code> -- actual generated number of weights, from Poisson</li>
<li><code>w</code> -- array of weights</li>
<li><code>S, B</code> -- expected values for $\sum w$ and $\sum(1-w)$, calulated from wfun</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test with a function peaked at both ends, generate equal signal and background</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">test_gen</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test with alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="si">}</span><span class="s1">, beta=</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span>  <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">beta</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span><span class="p">);</span> 
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated cell info:</span><span class="se">\n</span><span class="si">{</span> <span class="n">ll</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fit</span> <span class="o">=</span> <span class="n">ll</span><span class="o">.</span><span class="n">fit_info</span><span class="p">(</span><span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="mi">2</span> <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">1</span><span class="si">}</span><span class="s1">-D fit info:</span><span class="se">\n</span><span class="si">{</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">alpha</span><span class="p">),</span>  <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span>
    <span class="n">check_alpha</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span>  <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;alpha: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;Failed: </span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1"> &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">,</span> <span class="n">sigt</span> <span class="o">=</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;beta&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="n">fit</span><span class="p">[</span><span class="s1">&#39;sig_beta&#39;</span><span class="p">]</span>
        <span class="n">check_beta</span> <span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">&lt;</span><span class="n">tol</span><span class="o">*</span><span class="n">sigt</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;beta: abs(</span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">) &gt; </span><span class="si">{</span><span class="n">tol</span><span class="si">}</span><span class="s1"> * </span><span class="si">{</span><span class="n">sigt</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_alpha</span><span class="p">)</span>  <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">check_beta</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">check_alpha</span><span class="si">}</span><span class="s1">  </span><span class="si">{</span><span class="n">check_beta</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="c1">#test_gen(10, 0, tol=5, quiet=False)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_gen</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Test with alpha=0.1, beta=None
Generated cell info:
light_curves.loglike.LogLike:  10547 weights, S 4998.5, B 5001.5
1-D fit info:
counts      10547.000
flux            1.117
sig_flux        0.017
dtype: float64
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="generate_cells" class="doc_header"><code>generate_cells</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/simulation.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>generate_cells</code>(<strong><code>config</code></strong>, <strong><code>source</code></strong>, <strong><code>wfun</code></strong>, <strong><code>source_flux</code></strong>)</p>
</blockquote>
<ul>
<li><code>source</code> -- a PointSource object, use to get exposure at its position</li>
<li><code>wfun</code>   -- a weight function or histogram</li>
<li><code>flux_fun</code> -- function of MJD time for the counts/day</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Generate-a-set-of-poisson-like-fits-to-the-likelihoods">Generate a set of poisson-like fits to the likelihoods<a class="anchor-link" href="#Generate-a-set-of-poisson-like-fits-to-the-likelihoods"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">simulation_test</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ## Test the cell creation</span>
<span class="sd">    </span>
<span class="sd">    Generate {N} cells with the function {wfun}</span>

<span class="sd">    The &quot;pulls&quot;</span>
<span class="sd">    {fig1}</span>
<span class="sd">    </span>
<span class="sd">    A better measure of the shape is to evaluate the cumulative probability of the over-all mean</span>
<span class="sd">    for each likelihood function. This uses the `poisson.Poisson.cdf` function.</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">wfun</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="k">def</span> <span class="nf">generate_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">return</span>  <span class="p">[</span><span class="n">generate_cell</span><span class="p">(</span> <span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span> <span class="p">,</span><span class="n">alpha</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
    <span class="n">cells</span> <span class="o">=</span>  <span class="n">generate_cells</span><span class="p">(</span><span class="n">wfun</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

    <span class="n">pfits</span>  <span class="o">=</span> <span class="p">[</span><span class="n">PoissonRep</span><span class="p">(</span><span class="n">LogLike</span><span class="p">(</span><span class="n">cell</span> <span class="p">))</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">]</span>

    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="o">.</span><span class="n">flux</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pfits</span><span class="p">]);</span> 
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Flux: mean, std: </span><span class="si">{</span><span class="n">flux</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">flux</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">fmean</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
    <span class="k">def</span> <span class="nf">pull</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">f</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">errors</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">f</span><span class="o">-</span><span class="n">fmean</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
    <span class="n">pulls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">pull</span><span class="p">,</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; pull: mean, std: </span><span class="si">{</span><span class="n">pulls</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">pulls</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pulls</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;pull&#39;</span><span class="p">);</span> 
    <span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">300</span>

    <span class="k">class</span> <span class="nc">CDF</span><span class="p">():</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="n">alpha</span>
        <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">cdf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fmean</span><span class="o">=</span><span class="mf">1.1</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">poiss</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">fmean</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">CDF</span><span class="p">(</span><span class="n">alpha</span><span class="p">),</span> <span class="n">pfits</span><span class="p">)))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cd</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">21</span><span class="p">),</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
                            
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_test</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Flux: mean, std: 3.003, 0.260
 pull: mean, std: -0.029, 1.005
</pre>
</div>
</div>

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Test-the-cell-creation">Test the cell creation<a class="anchor-link" href="#Test-the-cell-creation"> </a></h2><p>Generate 10000 cells with the function &lt;function simulation_test.<locals>.<lambda> at 0x7f70a1d6c5f0&gt;</p>
<p>The "pulls"</p>
<div class="nbdoc_image">
<a href="images/simulation_test_fig_01.png"><figure style="margin-left: 5%">
   <img src="images/simulation_test_fig_01.png" alt="Figure 1 at images/simulation_test_fig_01.png" width=300> 
</figure></a></div><p>A better measure of the shape is to evaluate the cumulative probability of the over-all mean
for each likelihood function. This uses the <code>poisson.Poisson.cdf</code> function.</p>
<div class="nbdoc_image">
<a href="images/simulation_test_fig_03.png"><figure style="margin-left: 5%">
   <img src="images/simulation_test_fig_03.png" alt="Figure 3 at images/simulation_test_fig_03.png" width=300> 
</figure></a></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">simulation_lightcurve_demo</span><span class="p">(</span><span class="n">source_name</span><span class="o">=</span><span class="s1">&#39;Geminga&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ### Lightcurve generation test</span>
<span class="sd">    </span>
<span class="sd">    This uses the exposure measured for the source {source_name}, and</span>
<span class="sd">    the default time bins to create a light curve assuming a fixed flux</span>
<span class="sd">    and a histogram of weights from the data.</span>
<span class="sd">    {output}</span>
<span class="sd">    </span>
<span class="sd">    {fig}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s1">&#39;Geminga&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Print out&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output</span><span class="p">:</span>
        <span class="n">whist</span> <span class="o">=</span> <span class="n">get_weight_hist</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="n">cells</span> <span class="o">=</span>  <span class="n">generate_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">whist</span><span class="p">,</span> 
                        <span class="n">source_flux</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fit_cells</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cells</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">flux_plot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">fits</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">:</span>
    <span class="n">nbdoc</span><span class="p">(</span><span class="n">simulation_lightcurve_demo</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Lightcurve-generation-test">Lightcurve generation test<a class="anchor-link" href="#Lightcurve-generation-test"> </a></h3><p>This uses the exposure measured for the source Geminga, and
the default time bins to create a light curve assuming a fixed flux
and a histogram of weights from the data.</p>
<p><details class="descripton" ><summary data-open="Hide " data-close="Show "> Print out </summary> <p style="margin-left: 5%"><pre>Weight histogram for Geminga: Restoring from cache with key "weight_hist_Geminga"<br>binned exposure for source Geminga: Restoring from cache with key "binned_exposure_Geminga"<br>Loaded 3873 / 4015 cells with exposure > 0.3 for fitting<br></pre></p> </details></p>
<div class="nbdoc_image">
<a href="images/simulation_lightcurve_demo_fig_01.png"><figure style="margin-left: 5%">
   <img src="images/simulation_lightcurve_demo_fig_01.png" alt="Figure 1 at images/simulation_lightcurve_demo_fig_01.png" width=500> 
</figure></a></div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

