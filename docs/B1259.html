---

title: B1259-63 Analysis

keywords: fastai
sidebar: home_sidebar

summary: "Create a B1259-63 (aka PSR J1302-6350) light curve using Bayesian Blocks  "
description: "Create a B1259-63 (aka PSR J1302-6350) light curve using Bayesian Blocks  "
nb_path: "nbs/B1259.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/B1259.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><p><a href="https://arxiv.org/pdf/astro-ph/0506280.pdf">HESS high-energy results</a></p>
</li>
<li><p><a href="https://arxiv.org/pdf/1912.05868.pdf">Previouis <em>fermi</em> paper</a></p>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="B1259" class="doc_header"><code>class</code> <code>B1259</code><a href="https://github.com/tburnett/light_curves/tree/master/light_curves/b1259.py#L14" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>B1259</code>(<strong>**<code>kwargs</code></strong>) :: <code>WtLike</code></p>
</blockquote>
<p>Inherit from <code>LightCurve</code> and add Bayesian Block capability</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">daily</span> <span class="o">=</span> <span class="n">B1259</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SourceData: photons and exposure for PSR B1259-63: Restoring from cache with key &#34;PSR B1259-63_data&#34;
B1259: Source PSR B1259-63 with:
	 data:     1,335,825 photons from   2008-08-04 to 2021-05-06
	 exposure: 3,351,183 intervals from 2008-08-04 to 2021-05-06
CellData: Bin photon data into 4657 1-day bins from 54683.0 to 59340.0
LightCurve: select 4509 cells for fitting with e&gt;0.5 &amp; n&gt;2
B1259_BB: Restoring from cache
Partitioned 4509 cells into 32 blocks, using LikelihoodFitness 
LightCurve: Loaded 32 / 32 cells for fitting
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">B1259</span><span class="p">(</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ## Fit to all data</span>

<span class="sd">    {date}</span>
<span class="sd">    </span>
<span class="sd">    Create a `WtLike` object with all the data</span>
<span class="sd">    </span>
<span class="sd">    {outp}</span>
<span class="sd"> </span>
<span class="sd">    Combine the likelihoods for all the data, check the fit. </span>
<span class="sd">    Normalization should be very close to 1.0, a check on the weights.</span>
<span class="sd">    {fig1}</span>
<span class="sd">    </span>
<span class="sd">    Note that the &quot;significant count factor&quot;, $\sigma_{{flux}} \times \sqrt{{N}}$, is {sig_cnt_factor:.0f}.</span>
<span class="sd"> </span>
<span class="sd">    ## The full daily-interval light curve, showing the BB partitions</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    ## Expand about each periastron</span>
<span class="sd"> </span>
<span class="sd">    #### Periastron dates</span>

<span class="sd">    Assuming {period}-day orbital period, the MJD and UTC values are:</span>
<span class="sd">    </span>
<span class="sd">    {utc}</span>
<span class="sd"> </span>
<span class="sd">    Expand the above about those dates</span>

<span class="sd">    {fig3}</span>
<span class="sd">    </span>
<span class="sd">    ## Recent detail </span>
<span class="sd">    {out4}{fig4}</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">daily</span> <span class="c1">#  make availlable for follow-up cells</span>

 
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="c1">#, &#39;display.colheader_justify&#39;,&#39;left&#39;)</span>

    
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Output from analysis: create cells, fit each, run BB partition, fit partitions.&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">daily</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">clear</span><span class="p">:</span>
            <span class="n">daily</span> <span class="o">=</span> <span class="n">B1259Periastron</span><span class="p">(</span><span class="n">time_bins</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">clear</span><span class="o">=</span><span class="n">clear</span><span class="p">)</span>
            <span class="n">daily</span><span class="o">.</span><span class="n">applyBB</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;(already done)&#39;</span><span class="p">)</span>
    <span class="n">lc</span> <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">fits</span>
    <span class="n">bb_lc</span> <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">bb_fit</span>
    <span class="n">period</span>  <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">period</span>

    <span class="c1"># Fig 1 -- fit to combined data</span>
    
    <span class="n">lka</span> <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">full_likelihood</span><span class="p">()</span>
    <span class="n">fig1</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">lka</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">fi</span> <span class="o">=</span> <span class="n">lka</span><span class="o">.</span><span class="n">fit_info</span><span class="p">();</span> 
    <span class="n">sig_cnt_factor</span> <span class="o">=</span>  <span class="n">fi</span><span class="p">[</span><span class="s1">&#39;sig_flux&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fi</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">])</span>
    
    <span class="n">bb_df</span> <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">bb_table</span><span class="p">()</span>
    <span class="n">df_text</span> <span class="o">=</span> <span class="n">monospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">bb_df</span><span class="p">),</span> <span class="s1">&#39;BB fit table&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># fig 2: full light curbe</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span> <span class="n">daily</span><span class="o">.</span><span class="n">plot_BB</span><span class="p">(</span><span class="n">fignum</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> 
                  <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    
    <span class="c1"># fig 3 -- stack light curves</span>
    <span class="n">utc</span> <span class="o">=</span> <span class="n">monospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">daily</span><span class="o">.</span><span class="n">date_info</span><span class="p">()))</span> 
    <span class="n">fig3</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span> <span class="n">daily</span><span class="o">.</span><span class="n">stacked_plots</span><span class="p">(</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">300</span><span class="p">),</span> <span class="n">fignum</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
    
    <span class="c1"># fig 4 -- recent with orbit</span>
    <span class="n">tzero</span><span class="o">=</span><span class="n">daily</span><span class="o">.</span><span class="n">mjd_dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Recent 1/2-day bins, new BB&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out4</span><span class="p">:</span>
        <span class="n">half_day</span> <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="n">tzero</span><span class="o">+</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">half_day</span><span class="o">.</span><span class="n">applyBB</span><span class="p">()</span>
    <span class="n">fig4</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
           <span class="n">half_day</span><span class="o">.</span><span class="n">plot_BB</span><span class="p">(</span><span class="n">fignum</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;coral&#39;</span><span class="p">,</span> <span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">),</span>
                 <span class="n">tzero</span><span class="o">=</span><span class="n">tzero</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">90</span> <span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Days after 2021 Periastron&#39;</span><span class="p">,</span>
                         <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">400</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">)),</span> 
        <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>

   
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>

<span class="n">nbdoc</span><span class="p">(</span><span class="n">B1259</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Fit-to-all-data">Fit to all data<a class="anchor-link" href="#Fit-to-all-data"> </a></h2><p>2021-05-07 17:31</p>
<p>Create a <code>WtLike</code> object with all the data</p>
<p><details  class="nbdoc-description" >  <summary> Output from analysis: create cells, fit each, run BB partition, fit partitions. </summary>  <div style="margin-left: 5%"><pre>(already done)<br></pre></div> </details></p>
<p>Combine the likelihoods for all the data, check the fit. 
Normalization should be very close to 1.0, a check on the weights.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/B1259_fig_01.png" title="images/B1259_fig_01.png">    <img src="images/B1259_fig_01.png" alt="Figure 1 at images/B1259_fig_01.png" >   </a> </figure>
</div><p>Note that the "significant count factor", $\sigma_{flux} \times \sqrt{N}$, is 174.</p>
<h2 id="The-full-daily-interval-light-curve,-showing-the-BB-partitions">The full daily-interval light curve, showing the BB partitions<a class="anchor-link" href="#The-full-daily-interval-light-curve,-showing-the-BB-partitions"> </a></h2><div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 2">  <a href="images/B1259_fig_02.png" title="images/B1259_fig_02.png">    <img src="images/B1259_fig_02.png" alt="Figure 2 at images/B1259_fig_02.png" width=600>   </a> </figure>
</div><h2 id="Expand-about-each-periastron">Expand about each periastron<a class="anchor-link" href="#Expand-about-each-periastron"> </a></h2><h4 id="Periastron-dates">Periastron dates<a class="anchor-link" href="#Periastron-dates"> </a></h4><p>Assuming 1236.7243-day orbital period, the MJD and UTC values are:</p>
<div style="margin-left: 5%"><pre>         MJD               UTC<br>0  55544.694  2010-12-14 16:39<br>1  56781.418  2014-05-04 10:02<br>2  58018.143  2017-09-22 03:25<br>3  59254.867  2021-02-09 20:48</pre></div><p>Expand the above about those dates</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/B1259_fig_03.png" title="images/B1259_fig_03.png">    <img src="images/B1259_fig_03.png" alt="Figure 3 at images/B1259_fig_03.png" width=600>   </a> </figure>
</div><h2 id="Recent-detail">Recent detail<a class="anchor-link" href="#Recent-detail"> </a></h2><p><details  class="nbdoc-description" >  <summary> Recent 1/2-day bins, new BB </summary>  <div style="margin-left: 5%"><pre>CellData: Bin photon data into 70 12-hour bins from 59304.9 to 59339.9<br>LightCurve: select 70 cells for fitting with e&gt;0.5 & n&gt;2<br>Partitioned 70 cells into 6 blocks, using LikelihoodFitness <br>LightCurve: Loaded 6 / 6 cells for fitting<br></pre></div> </details><div class="nbdoc_image"></p>
<p><figure style="margin-left: 5%" title="Figure 4">  <a href="images/B1259_fig_04.png" title="images/B1259_fig_04.png">    <img src="images/B1259_fig_04.png" alt="Figure 4 at images/B1259_fig_04.png" width=600>   </a> </figure>
&lt;/div&gt;</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Questions-for-Discussion,-with-2/28-Scargle-comments">Questions for Discussion, with 2/28 Scargle comments<a class="anchor-link" href="#Questions-for-Discussion,-with-2/28-Scargle-comments"> </a></h2><h4 id="How-do-I-interpret-the-apparent-abrupt-transitions?">How do I interpret the apparent abrupt transitions?<a class="anchor-link" href="#How-do-I-interpret-the-apparent-abrupt-transitions?"> </a></h4><blockquote><p>Think of BB as the best step-function representation
of the data.  It does not mean that the discontinuities 
are claimed to be real -- the underlying light curve
is most likely continuous and smooth at some level.<br>
BB is just saying that there is a statistically significant
change from one block to the next.</p>
</blockquote>
<p>Compare with a <a href="https://tburnett.github.io/wtlike/bayesian.html#bb_overplot">flare from 3C 279</a>, which has measurements rather than limits for each day and the time scale is in the day range.</p>
<h4 id="Is-the-day-interval-appropriate?">Is the day interval appropriate?<a class="anchor-link" href="#Is-the-day-interval-appropriate?"> </a></h4><blockquote><p>BB can always benefit from finer sampling, so if you
have data on shorter intervals (or even photon data)
you can get more information out ... e.g. a better 
determination of the time of "transitions" (see above).</p>
</blockquote>
<h4 id="I-know-that-there-is-a-~4%-systematic-for-the-individual-daily-measurements,-seen-in-the-Geminga-data.-Does-this-matter?">I know that there is a ~4% systematic for the individual daily measurements, seen in the Geminga data. Does this matter?<a class="anchor-link" href="#I-know-that-there-is-a-~4%-systematic-for-the-individual-daily-measurements,-seen-in-the-Geminga-data.-Does-this-matter?"> </a></h4><blockquote><p>Systematic errors are a problem ... BB is not magic here.</p>
</blockquote>
<h2 id="My-observations,-plans">My observations, plans<a class="anchor-link" href="#My-observations,-plans"> </a></h2><p>There are two related questions here.</p>
<ol>
<li>what is the actual behavior of B1259, besides the obvious flares? Can we characterize each periastron to detect changes? Kent Wood is very interested in this.</li>
<li>How well does BB work, when applied to daily likelihoods, many of which are just limits, but do contain information? This is a question that Jeff Scargle had never considered before, but is quite interested in.</li>
</ol>
<h4 id="Run-Simulations">Run Simulations<a class="anchor-link" href="#Run-Simulations"> </a></h4><p>I'll use the <a href="https://tburnett.github.io/wtlike/simulation">wtlike simulation capability</a> to test the sensitivity to various light curves, when daily fits are all or mostly limits.</p>
<h4 id="Add-Systematics-to-Likelihood">Add Systematics to Likelihood<a class="anchor-link" href="#Add-Systematics-to-Likelihood"> </a></h4><p>The presence of a systematic error in the exposure--I've measured 4% with Geminga, slightly invalidates the likelihood. A fix is to widen it, which I can easily do using the <a href="https://tburnett.github.io/wtlike/poisson#Poisson">wtlike Poisson representation</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Comparison-with-Tyrel's-gtlike-results">Comparison with Tyrel's gtlike results<a class="anchor-link" href="#Comparison-with-Tyrel's-gtlike-results"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">remote_file</span> <span class="o">=</span> <span class="s1">&#39;/nfs/farm/g/glast/u/tyrelj/forToby/FluxLC_output_PSRB1259.fits&#39;</span>
<span class="n">local_copy</span> <span class="o">=</span> <span class="s1">&#39;/home/burnett/fromTyrel/FluxLC_output_PSRB1259.fits&#39;</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>

<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">local_copy</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdus</span><span class="p">:</span> 
    <span class="n">tdata</span> <span class="o">=</span> <span class="n">hdus</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="n">flux_factor</span> <span class="o">=</span> <span class="mf">4.28e7</span> <span class="c1"># derived before, so apply here</span>
<span class="n">tdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">MJD</span><span class="p">((</span><span class="n">tdata</span><span class="o">.</span><span class="n">Start</span><span class="o">+</span><span class="n">tdata</span><span class="o">.</span><span class="n">Stop</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">TS</span> <span class="o">=</span> <span class="n">tdata</span><span class="o">.</span><span class="n">TS</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">flux</span> <span class="o">=</span> <span class="p">(</span><span class="n">tdata</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">*</span><span class="n">flux_factor</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">flux_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">tdata</span><span class="o">.</span><span class="n">flux_error</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">*</span><span class="n">flux_factor</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">limit</span> <span class="o">=</span> <span class="p">(</span><span class="n">tdata</span><span class="o">.</span><span class="n">UpperLimit</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">*</span><span class="n">flux_factor</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                       <span class="p">)</span>
                    <span class="p">);</span> 
<span class="c1">#tdf.describe(percentiles=[])</span>

<span class="c1">#### Get my results for these dates</span>

<span class="o">%</span><span class="k">nbdev_collapse_input</span>
<span class="n">lc</span><span class="o">=</span><span class="n">daily</span><span class="o">.</span><span class="n">lc</span><span class="p">;</span> 
<span class="n">mdf</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;59319&gt;t&gt;59093&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">mdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">ts</span><span class="p">)</span>
<span class="n">mdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mdf</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
<span class="n">mdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">flux</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">mdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;limit&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">limit</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#mdf[&#39;t ts flux errors limit&#39;.split()].describe(percentiles=[])</span>

<span class="c1">### Use the last one, at 59318.5, +63, to make tentative normalization</span>


<span class="n">f</span> <span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Compare point at </span><span class="si">{</span><span class="n">mdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">t</span><span class="si">}</span><span class="s1">: TS: me </span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">ts</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">, Tyrel </span><span class="si">{</span><span class="n">tdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">TS</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">tdf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flux</span><span class="p">;</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;flux ratio check: </span><span class="si">{</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="si">:</span><span class="s1">.3e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mdf</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span> <span class="n">tdf</span><span class="o">.</span><span class="n">TS</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;wtlike TS&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;gtlike TS&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">mtscut</span><span class="o">=</span> <span class="p">(</span><span class="n">mdf</span><span class="o">.</span><span class="n">ts</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mdf</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">tdf</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mdf</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">mtscut</span><span class="p">],</span> <span class="n">tdf</span><span class="p">[</span><span class="n">mtscut</span><span class="p">]</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;wtlike TS&gt;4&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">);</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;wtlike flux&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;gtlike flux x </span><span class="si">{</span><span class="n">flux_factor</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span><span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>

<span class="n">ttscut</span><span class="o">=</span><span class="p">(</span><span class="n">tdf</span><span class="o">.</span><span class="n">TS</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mdf</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="n">tdf</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mdf</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">ttscut</span><span class="p">],</span> <span class="n">tdf</span><span class="p">[</span><span class="n">ttscut</span><span class="p">]</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span> <span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;gtlike TS&gt;4&#39;</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">],</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">);</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;wtlike flux&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;gtlike flux x </span><span class="si">{</span><span class="n">flux_factor</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">70</span><span class="p">))</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span><span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-4-abc66a217dcd&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     20</span> 
<span class="ansi-green-intense-fg ansi-bold">     21</span> get_ipython<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>run_line_magic<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;nbdev_collapse_input&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 22</span><span class="ansi-red-fg"> </span>lc<span class="ansi-blue-fg">=</span>daily<span class="ansi-blue-fg">.</span>lc<span class="ansi-blue-fg">;</span>
<span class="ansi-green-intense-fg ansi-bold">     23</span> mdf <span class="ansi-blue-fg">=</span> lc<span class="ansi-blue-fg">.</span>dataframe<span class="ansi-blue-fg">.</span>query<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;59319&gt;t&gt;59093&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>copy<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     24</span> mdf<span class="ansi-blue-fg">.</span>loc<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">&#39;ts&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">=</span> mdf<span class="ansi-blue-fg">.</span>fit<span class="ansi-blue-fg">.</span>apply<span class="ansi-blue-fg">(</span><span class="ansi-green-fg">lambda</span> x<span class="ansi-blue-fg">:</span> x<span class="ansi-blue-fg">.</span>ts<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;daily&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Add-my-TS,-flux-to-Tyrel-list">Add my TS, flux to Tyrel list<a class="anchor-link" href="#Add-my-TS,-flux-to-Tyrel-list"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;wt_ts&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">values</span>
<span class="n">tdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;wt_flux&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mdf</span><span class="o">.</span><span class="n">flux</span><span class="o">.</span><span class="n">values</span>
<span class="n">tdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;wt_errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdf</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">values</span>

<span class="n">pa</span> <span class="o">=</span> <span class="n">daily</span><span class="p">;</span> <span class="n">tzero</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">date_info</span><span class="p">()</span><span class="o">.</span><span class="n">MJD</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">mcut</span><span class="o">=</span><span class="n">mdf</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="mi">4</span>
<span class="n">tcut</span><span class="o">=</span><span class="n">tdf</span><span class="o">.</span><span class="n">TS</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="mi">4</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">mdf</span><span class="o">.</span><span class="n">t</span><span class="o">-</span><span class="n">tzero</span><span class="p">)[</span><span class="n">mcut</span><span class="p">],</span> <span class="n">mdf</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">mcut</span><span class="p">],</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;wtlike&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">tdf</span><span class="o">.</span><span class="n">t</span><span class="o">-</span><span class="n">tzero</span><span class="p">)[</span><span class="n">tcut</span><span class="p">],</span> <span class="n">tdf</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">tcut</span><span class="p">],</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;gtlike&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">90</span><span class="p">),</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Days about periastron&#39;</span><span class="p">,</span> 
       <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">);</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;TS&gt;4 cut on respective data sets&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Generate-table-of-3-day-fits,-to-compare-with-LightCurveRepository">Generate table of 3-day fits, to compare with LightCurveRepository<a class="anchor-link" href="#Generate-table-of-3-day-fits,-to-compare-with-LightCurveRepository"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">wt3</span> <span class="o">=</span> <span class="n">daily</span><span class="o">.</span><span class="n">view</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">wt3</span><span class="o">.</span><span class="n">plot_BB</span><span class="p">();</span>

<span class="n">ft</span> <span class="o">=</span> <span class="n">wt3</span><span class="o">.</span><span class="n">flux_table</span><span class="p">()</span>

<span class="n">ft</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;../b1259_3day.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

