---

title: B1259-63 Analysis

keywords: fastai
sidebar: home_sidebar

summary: "Create a B1259-63 (aka PSR J1302-6350) light curve using Bayesian Blocks  "
description: "Create a B1259-63 (aka PSR J1302-6350) light curve using Bayesian Blocks  "
nb_path: "nbs/B1259.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/B1259.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><p><a href="https://arxiv.org/pdf/astro-ph/0506280.pdf">HESS high-energy results</a></p>
</li>
<li><p><a href="https://arxiv.org/pdf/1912.05868.pdf">Previouis <em>fermi</em> paper</a></p>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary data-open="Hide Code" data-close="Show Code"></summary>
        <summary></summary>
        <div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">light_curves.tools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">wtlike.config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">utilities.ipynb_docgen</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">bb_lc</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">lc</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">B1259</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;PSR_B1259-63&#39;</span><span class="p">,</span> <span class="n">expect</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ## Fit to all data</span>
<span class="sd">    </span>
<span class="sd">    Combine the likelihoods for all the data, check the fit.</span>
<span class="sd">    </span>
<span class="sd">    {outp}</span>
<span class="sd">    This plot is a consistency check of the weighted likelihood for the full interval. </span>
<span class="sd">    </span>
<span class="sd">    {fig1}</span>
<span class="sd">    </span>
<span class="sd">    ## The full daily-interval light curve, showing the BB partitions</span>
<span class="sd">    {fig2}</span>
<span class="sd">    </span>
<span class="sd">    ### Periastron dates</span>
<span class="sd">    Assuming {p}-day orbital period, the MJD and UTC values are:</span>
<span class="sd">    </span>
<span class="sd">    {utc}</span>
<span class="sd">    </span>
<span class="sd">    Expand the above about those dates</span>
<span class="sd">    </span>
<span class="sd">    {fig3}</span>
<span class="sd">    </span>
<span class="sd">    ### Table with the intervals:</span>
<span class="sd">    {lc_display}</span>
<span class="sd">    </span>
<span class="sd">    Download it: [{lc_file}]({lc_file}).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">lc</span><span class="p">,</span> <span class="n">bb_lc</span> <span class="c1"># make these availlable for follow-up cells</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">valid</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid configuration </span><span class="si">{</span><span class="n">config</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Output from setup&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outp</span><span class="p">:</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="n">all_data_likelihood</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>

    <span class="c1">#print(ll,&#39;\nFit: &#39;, ll.fit_info())</span>
    <span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">ll</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlim</span> <span class="o">=</span><span class="p">(</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
   
    <span class="k">with</span> <span class="n">capture_print</span><span class="p">(</span><span class="s1">&#39;Analysis output&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outp</span><span class="p">:</span>
        <span class="n">lc</span><span class="p">,</span> <span class="n">bb_lc</span> <span class="o">=</span> <span class="n">analyze_data</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        
    <span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.precision&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="c1">#, &#39;display.colheader_justify&#39;,&#39;left&#39;)</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">fit_table</span><span class="p">(</span><span class="n">bb_lc</span><span class="p">,</span> <span class="n">expect</span><span class="o">=</span><span class="n">expect</span><span class="p">)</span>
    <span class="n">df_text</span> <span class="o">=</span> <span class="n">monospace</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="s1">&#39;BB fit table&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">bb_overplot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">bb_lc</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>  <span class="n">transform</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">transAxes</span><span class="p">);</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">fig2</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span>
    
    <span class="n">tp</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span><span class="mi">55546</span><span class="p">,</span> <span class="mi">1237</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">dict</span><span class="p">(</span><span class="n">MET</span><span class="o">=</span><span class="n">tp</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">UTC</span><span class="o">=</span><span class="n">UTC</span><span class="p">(</span><span class="n">tp</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">p</span><span class="p">))</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">]</span>
    <span class="n">utc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> 
    
    <span class="n">fig3</span><span class="p">,</span> <span class="n">axx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span> <span class="n">num</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axx</span><span class="o">.</span><span class="n">flatten</span><span class="p">()):</span>
        <span class="n">bb_overplot</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">lc</span><span class="p">,</span> <span class="n">bb_lc</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">tzero</span><span class="o">=</span><span class="n">tp</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span> <span class="c1">#, colors=(&#39;black&#39;,&#39;wheat&#39;,&#39;blue&#39;))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">UTC</span><span class="p">(</span><span class="n">tp</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">p</span><span class="p">)[:</span><span class="mi">4</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">fig3</span><span class="o">.</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span>
    
    <span class="c1">### Save the BB intervals</span>
    <span class="n">lc_out</span> <span class="o">=</span> <span class="n">bb_lc</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">lc_out</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bb_lc</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fit</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">flux</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">bb_lc</span><span class="o">.</span><span class="n">fit</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fit</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">errors</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
    <span class="n">elow</span><span class="p">,</span> <span class="n">ehigh</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>
    <span class="n">lc_out</span><span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">elow</span>
    <span class="n">lc_out</span><span class="p">[</span><span class="s1">&#39;high&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ehigh</span>
    <span class="n">lc_display</span> <span class="o">=</span> <span class="n">lc_out</span><span class="p">[</span><span class="s1">&#39;t tw n flux low high&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
    <span class="n">lc_file</span> <span class="o">=</span> <span class="s1">&#39;images/B1259_lc.csv&#39;</span>
    <span class="n">lc_display</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">lc_file</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>
<span class="n">nbdoc</span><span class="p">(</span><span class="n">B1259</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Fit-to-all-data">Fit to all data<a class="anchor-link" href="#Fit-to-all-data"> </a></h2><p>Combine the likelihoods for all the data, check the fit.</p>
<p><details  class="nbdoc-description" >  <summary> Analysis output </summary>  <div style="margin-left: 5%"><pre>Light curve for PSR_B1259-63: Restoring from cache with key "lightfcurve_PSR_B1259-63"<br>Cell data for PSR_B1259-63: Restoring from cache with key "cells_PSR_B1259-63"<br>BB-PSR_B1259-63: Restoring from cache with key "BB-PSR_B1259-63"<br>Partitioned 3840 cells into 22 blocks, using LikelihoodFitness <br>Loaded 22 / 22 cells with exposure &gt; 0.3 for fitting<br></pre></div> </details>
This plot is a consistency check of the weighted likelihood for the full interval.</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 1">  <a href="images/B1259_fig_01.png" title="images/B1259_fig_01.png">    <img src="images/B1259_fig_01.png" alt="Figure 1 at images/B1259_fig_01.png" >   </a> </figure>
</div><h2 id="The-full-daily-interval-light-curve,-showing-the-BB-partitions">The full daily-interval light curve, showing the BB partitions<a class="anchor-link" href="#The-full-daily-interval-light-curve,-showing-the-BB-partitions"> </a></h2><div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 2">  <a href="images/B1259_fig_02.png" title="images/B1259_fig_02.png">    <img src="images/B1259_fig_02.png" alt="Figure 2 at images/B1259_fig_02.png" width=600>   </a> </figure>
</div><h3 id="Periastron-dates">Periastron dates<a class="anchor-link" href="#Periastron-dates"> </a></h3><p>Assuming 1237-day orbital period, the MJD and UTC values are:</p>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>MET</th>
      <th>UTC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>55546</td>
      <td>2010-12-16 00:00</td>
    </tr>
    <tr>
      <td>56783</td>
      <td>2014-05-06 00:00</td>
    </tr>
    <tr>
      <td>58020</td>
      <td>2017-09-24 00:00</td>
    </tr>
    <tr>
      <td>59257</td>
      <td>2021-02-12 00:00</td>
    </tr>
  </tbody>
</table>
</div><p>Expand the above about those dates</p>
<div class="nbdoc_image">
<figure style="margin-left: 5%" title="Figure 3">  <a href="images/B1259_fig_03.png" title="images/B1259_fig_03.png">    <img src="images/B1259_fig_03.png" alt="Figure 3 at images/B1259_fig_03.png" width=600>   </a> </figure>
</div><h3 id="Table-with-the-intervals:">Table with the intervals:<a class="anchor-link" href="#Table-with-the-intervals:"> </a></h3><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>t</th>
      <th>tw</th>
      <th>n</th>
      <th>flux</th>
      <th>low</th>
      <th>high</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>55088.500</td>
      <td>811.000</td>
      <td>421805</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.076</td>
    </tr>
    <tr>
      <td>55534.000</td>
      <td>80.000</td>
      <td>53111</td>
      <td>4.478</td>
      <td>3.194</td>
      <td>5.788</td>
    </tr>
    <tr>
      <td>55587.500</td>
      <td>27.000</td>
      <td>14780</td>
      <td>47.731</td>
      <td>44.203</td>
      <td>51.278</td>
    </tr>
    <tr>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <td>58089.000</td>
      <td>2.000</td>
      <td>1045</td>
      <td>117.303</td>
      <td>100.185</td>
      <td>134.777</td>
    </tr>
    <tr>
      <td>58359.000</td>
      <td>538.000</td>
      <td>309771</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>0.179</td>
    </tr>
    <tr>
      <td>58662.500</td>
      <td>69.000</td>
      <td>36122</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.460</td>
    </tr>
  </tbody>
</table>
</div><p>Download it: <a href="images/B1259_lc.csv">images/B1259_lc.csv</a>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

